{"version":3,"file":"../../woocommerce-points-and-rewards/redeem-points-130.min.js","sources":["woocommerce-points-and-rewards/redeem-points.js"],"sourcesContent":["/**\n * Apply discounts for the plugin WooCommerce Points and Rewards.\n *\n * DEPENDS ON:\n * - jQuery // Interact with WooCommerce events\n */\n(function (root, factory) {\n\tif ( typeof define === 'function' && define.amd ) {\n\t\tdefine([], factory(root));\n\t} else if ( typeof exports === 'object' ) {\n\t\tmodule.exports = factory(root);\n\t} else {\n\t\troot.PointsRewardsRedeemPoints = factory(root);\n\t}\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\n\n\t'use strict';\n\n\tvar $ = jQuery;\n\tvar _hasJQuery = ( $ != null );\n\n\tvar _hasInitialized = false;\n\tvar _isProcessing = false;\n\tvar _publicMethods = {};\n\tvar _settings = {\n\t\tbodyClass: 'has-fc-points-rewards-redeem-points',\n\n\t\tsubstepSelector: '.fc-step__substep[data-substep-id=\"coupon_codes\"]',\n\t\tredeemSectionSelector: '.wc_points_redeem_earn_points',\n\t\tredeemButtonSelector: '.wc_points_rewards_apply_discount',\n\t\tmessagesSelector: '.woocommerce-error, .woocommerce-message',\n\n\t\tmaxPointsFieldSelector: '[name=\"wc-points-rewards-max-points\"]',\n\t\tpointsToApplyFieldSelector: 'input.wc_points_rewards_apply_discount_amount',\n\t}\n\n\n\n\t/**\n\t * METHODS\n\t */\n\n\n\n\t/*!\n\t* Merge two or more objects together.\n\t* (c) 2017 Chris Ferdinandi, MIT License, https://gomakethings.com\n\t* @param   {Boolean}  deep     If true, do a deep (or recursive) merge [optional]\n\t* @param   {Object}   objects  The objects to merge together\n\t* @returns {Object}            Merged values of defaults and options\n\t*/\n\tvar extend = function () {\n\t\t// Variables\n\t\tvar extended = {};\n\t\tvar deep = false;\n\t\tvar i = 0;\n\n\t\t// Check if a deep merge\n\t\tif ( Object.prototype.toString.call( arguments[0] ) === '[object Boolean]' ) {\n\t\t\tdeep = arguments[0];\n\t\t\ti++;\n\t\t}\n\n\t\t// Merge the object into the extended object\n\t\tvar merge = function (obj) {\n\t\t\tfor (var prop in obj) {\n\t\t\t\tif (obj.hasOwnProperty(prop)) {\n\t\t\t\t\t// If property is an object, merge properties\n\t\t\t\t\tif (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n\t\t\t\t\t\textended[prop] = extend(extended[prop], obj[prop]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\textended[prop] = obj[prop];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Loop through each object and conduct a merge\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar obj = arguments[i];\n\t\t\tmerge(obj);\n\t\t}\n\n\t\treturn extended;\n\t};\n\n\n\n\t/**\n\t * Maybe prompt user for the amount of points to redeem.\n\t *\n\t * @return  bool  `true` if amount of points provided by the user was valid or if partial redemption is disabled or not possible at the moment, `false` if user cancelled the dialog or provided an invalid amount.\n\t */\n\tvar maybePromptPointsToRedeem = function() {\n\t\t// Bail if settings not available or partial redemption not enabled\n\t\tif ( ! window.fcSettings || ! fcSettings.woocommercePointsRewards || ! fcSettings.woocommercePointsRewards.partialRedemptionEnabled ) { return true; }\n\t\t\n\t\t// Get max points\n\t\tvar max_points = document.querySelector( _settings.maxPointsFieldSelector );\n\t\tvar pointsToApplyField = document.querySelector( _settings.pointsToApplyFieldSelector );\n\t\t\n\t\t// Bail if hidden fields for max amount of points or amount of points to redeem are not available\n\t\tif ( ! max_points || ! pointsToApplyField ) { return true; }\n\n\t\tvar points = prompt( fcSettings.woocommercePointsRewards.pointsToRedeemMessage, max_points.value );\n\t\tif ( null != points && 0 != points ) {\n\t\t\t\n\t\t\tif ( points >= fcSettings.woocommercePointsRewards.minPointsToRedeem ) {\n\t\t\t\t// Should continue with redemption\n\t\t\t\tpointsToApplyField.value = points;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Invalid amount of points\n\t\t\t\talert( fcSettings.woocommercePointsRewards.lessThanMinPointsMessage );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// User cancelled or value invalid\n\t\t\treturn false;\n\t\t}\n\t}\n\n\n\n\t/**\n\t * Sends the apply discount ajax request.\n\t * \n\t * Adapted from the inline script added by the original plugin.\n\t * \n\t * @see WC_Points_Rewards_Cart_Checkout::render_redeem_points_message()\n\t */\n\tvar submitPointsRedemption = function( e ) {\n\t\t// Bail if still processing a request for points redemption\n\t\tif ( _isProcessing ) { return; }\n\n\t\t// Maybe prompt how many points to redeem or cancel submit if dialog is cancelled by the user\n\t\tif ( ! maybePromptPointsToRedeem() ) { return; }\n\n\t\t// Get sections\n\t\tvar $substep = $( _settings.substepSelector );\n\t\tvar $section = $( _settings.redeemSectionSelector );\n\n\t\t// Set processing\n\t\t_isProcessing = true;\n\t\t$section.addClass( \"processing\" ).block({message: null, overlayCSS: {background: \"#fff\", opacity: 0.6}});\n\n\t\t// Remove existing messages\n\t\tvar $messages = $substep.find( _settings.messagesSelector );\n\t\t$messages.remove();\n\n\t\tvar data = {\n\t\t\taction: \"wc_points_rewards_apply_discount\",\n\t\t\tdiscount_amount: $(\"input.wc_points_rewards_apply_discount_amount\").val(),\n\t\t\tsecurity: ( woocommerce_params.apply_coupon_nonce ? woocommerce_params.apply_coupon_nonce : wc_checkout_params.apply_coupon_nonce )\n\t\t};\n\n\t\t$.ajax({\n\t\t\ttype:     \"POST\",\n\t\t\turl:      woocommerce_params.ajax_url,\n\t\t\tdata:     data,\n\t\t\tsuccess:  function( response ) {\n\t\t\t\tif ( response ) {\n\t\t\t\t\t// Display response as a message\n\t\t\t\t\t$substep.prepend( response );\n\n\t\t\t\t\t$( \"body\" ).trigger( \"update_checkout\" );\n\t\t\t\t}\n\t\t\t},\n\t\t\tdataType: \"html\"\n\t\t});\n\t}\n\n\n\n\t/**\n\t * Resets the processing flag state to `false`.\n\t */\n\tvar resetProcessingFlag = function () {\n\t\t_isProcessing = false;\n\t}\n\n\n\n\t/**\n\t * Handle document clicks and route to the appropriate function.\n\t */\n\tvar handleClick = function( e ) {\n\t\t// NEXT STEP\n\t\tif ( e.target.closest( _settings.redeemButtonSelector ) ) {\n\t\t\te.preventDefault();\n\t\t\tsubmitPointsRedemption( e );\n\t\t}\n\t};\n\n\n\n\t/**\n\t * Initialize component and set related handlers.\n\t */\n\t_publicMethods.init = function( options ) {\t\t\n\t\tif ( _hasInitialized ) return;\n\n\t\t// Merge settings\n\t\t_settings = extend( _settings, options );\n\n\t\t// Add event listeners\n\t\twindow.addEventListener( 'click', handleClick );\n\n\t\t// Add jQuery event listeners\n\t\tif ( _hasJQuery ) {\n\t\t\t$( document.body ).on( 'updated_checkout', resetProcessingFlag );\n\t\t}\n\n\t\t// Add init class\n\t\tdocument.body.classList.add( _settings.bodyClass );\n\n\t\t_hasInitialized = true;\n\t};\n\n\n\n\t//\n\t// Public APIs\n\t//\n\treturn _publicMethods;\n\n});\n"],"names":["root","factory","define","amd","exports","module","PointsRewardsRedeemPoints","global","this","window","submitPointsRedemption","e","$substep","data","_isProcessing","fcSettings","woocommercePointsRewards","partialRedemptionEnabled","max_points","document","querySelector","_settings","maxPointsFieldSelector","pointsToApplyField","pointsToApplyFieldSelector","points","prompt","pointsToRedeemMessage","value","minPointsToRedeem","alert","lessThanMinPointsMessage","maybePromptPointsToRedeem","$","substepSelector","$section","redeemSectionSelector","addClass","block","message","overlayCSS","background","opacity","find","messagesSelector","remove","action","discount_amount","val","security","woocommerce_params","apply_coupon_nonce","wc_checkout_params","ajax","type","url","ajax_url","success","response","prepend","trigger","dataType","resetProcessingFlag","handleClick","target","closest","redeemButtonSelector","preventDefault","jQuery","_hasJQuery","_hasInitialized","_publicMethods","bodyClass","extend","extended","deep","i","Object","prototype","toString","call","arguments","length","obj","prop","hasOwnProperty","merge","init","options","addEventListener","body","on","classList","add"],"mappings":"CAMA,SAAWA,EAAMC,GACO,mBAAXC,QAAyBA,OAAOC,IAC3CD,OAAO,GAAID,KACmB,iBAAZG,QAClBC,OAAOD,QAAUH,IAEjBD,EAAKM,0BAA4BL,IANnC,CAQqB,oBAAXM,OAAyBA,OAASC,KAAKC,QAAUD,KAAKD,OAAQ,SAAUP,gBAuHpD,SAAzBU,EAAmCC,GAEtC,IAMIC,EAWAC,EAjBCC,IA1C0B,WAE/B,IAAOL,OAAOM,aAAgBA,WAAWC,2BAA8BD,WAAWC,yBAAyBC,yBAA6B,OAAO,EAG/I,IAAIC,EAAaC,SAASC,cAAeC,EAAUC,wBAC/CC,EAAqBJ,SAASC,cAAeC,EAAUG,4BAG3D,IAAON,IAAgBK,EAAuB,OAAO,EAEjDE,EAASC,OAAQX,WAAWC,yBAAyBW,sBAAuBT,EAAWU,OAC3F,OAAK,MAAQH,GAAU,GAAKA,IAEtBA,GAAUV,WAAWC,yBAAyBa,mBAElDN,EAAmBK,MAAQH,GACpB,IAIPK,MAAOf,WAAWC,yBAAyBe,2BACpC,IAuBFC,KAGHpB,EAAWqB,EAAGZ,EAAUa,iBACxBC,EAAWF,EAAGZ,EAAUe,uBAG5BtB,GAAgB,EAChBqB,EAASE,SAAU,cAAeC,MAAM,CAACC,QAAS,KAAMC,WAAY,CAACC,WAAY,OAAQC,QAAS,MAGlF9B,EAAS+B,KAAMtB,EAAUuB,kBAC/BC,SAENhC,EAAO,CACViC,OAAQ,mCACRC,gBAAiBd,EAAE,iDAAiDe,MACpEC,SAAYC,mBAAmBC,oBAA6DC,mBAAmBD,oBAGhHlB,EAAEoB,KAAK,CACNC,KAAU,OACVC,IAAUL,mBAAmBM,SAC7B3C,KAAUA,EACV4C,QAAU,SAAUC,GACdA,IAEJ9C,EAAS+C,QAASD,GAElBzB,EAAG,QAAS2B,QAAS,qBAGvBC,SAAU,UASc,SAAtBC,IACHhD,GAAgB,EAQC,SAAdiD,EAAwBpD,GAEtBA,EAAEqD,OAAOC,QAAS5C,EAAU6C,wBAChCvD,EAAEwD,iBACFzD,KA9KF,IAAIuB,EAAImC,OACJC,EAAoB,MAALpC,EAEfqC,GAAkB,EAClBxD,GAAgB,EAChByD,EAAiB,GACjBlD,EAAY,CACfmD,UAAW,sCAEXtC,gBAAiB,oDACjBE,sBAAuB,gCACvB8B,qBAAsB,oCACtBtB,iBAAkB,2CAElBtB,uBAAwB,wCACxBE,2BAA4B,iDAkBzBiD,EAAS,WAEZ,IAAIC,EAAW,GACXC,GAAO,EACPC,EAAI,EAGgD,qBAAnDC,OAAOC,UAAUC,SAASC,KAAMC,UAAU,MAC9CN,EAAOM,UAAU,GACjBL,KAkBD,KAAOA,EAAIK,UAAUC,OAAQN,KAdjB,SAAUO,GACrB,IAAK,IAAIC,KAAQD,EACZA,EAAIE,eAAeD,KAElBT,GAAsD,oBAA9CE,OAAOC,UAAUC,SAASC,KAAKG,EAAIC,IAC9CV,EAASU,GAAQX,EAAOC,EAASU,GAAOD,EAAIC,IAE5CV,EAASU,GAAQD,EAAIC,IASxBE,CADUL,UAAUL,IAIrB,OAAOF,GA+IR,OAzBAH,EAAegB,KAAO,SAAUC,GAC1BlB,IAGLjD,EAAYoD,EAAQpD,EAAWmE,GAG/B/E,OAAOgF,iBAAkB,QAAS1B,GAG7BM,GACJpC,EAAGd,SAASuE,MAAOC,GAAI,mBAAoB7B,GAI5C3C,SAASuE,KAAKE,UAAUC,IAAKxE,EAAUmD,WAEvCF,GAAkB,IAQZC"}