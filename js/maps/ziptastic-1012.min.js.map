{"version":3,"file":"../ziptastic-1012.min.js","sources":["ziptastic.js"],"sourcesContent":["/**\n * Autocomplete address with Ziptastic API data.\n */\n\n(function( $ ){\n\n\t'use strict';\n\n\t/**\n\t * VARIABLES\n\t */\n\tvar hasJQuery = ( $ != null ),\n\t\tziptasticAPIKey = false,\n\t\tzipFields = '#billing_postcode, #shipping_postcode',\n\t\tfieldWrappers = '.woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields__field-wrapper, .woocommerce-address-fields__field-wrapper',\n\t\tcityFields = '#billing_city, #shipping_city',\n\t\tstateFields = '#billing_state, #shipping_state',\n\t\tcountryFields = '#billing_country, #shipping_country',\n\t\tminChars = 5;\n\n\n\n\t/**\n\t * METHODS\n\t */\n\t\n\n\t/**\n\t * Process successful zip api call and set new field values.\n\t * @param  {Element} target Element that triggered autocomplete event.\n\t * @param  {Object} data    Data returned by ziptastic.\n\t */\n\tvar processAutocomplete = function( target, data ) {\n\t\tvar wrapper = target.closest( fieldWrappers );\n\n\t\t// Bail if wrapper not found\n\t\tif ( ! wrapper ) { return; }\n\n\t\tvar city = wrapper.querySelector( cityFields ),\n\t\t\t\tstate = wrapper.querySelector( stateFields ),\n\t\t\t\tcountry = wrapper.querySelector( countryFields );\n\n\t\t// Update city value\n\t\tif ( city && city.value != data.city ) {\n\t\t\tcity.value = data.city;\n\t\t\tcity.dispatchEvent( new CustomEvent( 'change' ), { 'bubbles': true } );\n\t\t}\n\n\t\t// Update country value\n\t\tif ( country && country.value != data.country ) {\n\t\t\tif ( hasJQuery && $( country ).data( 'select2' ) ) {\n\t\t\t\t// Country is a select2 so it needs to trigger jQuery event\n\t\t\t\t$( country ).val( data.country ).trigger( 'change' );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcountry.value = data.country;\n\t\t\t}\n\t\t\t\n\t\t\t// Need to dispatch native event for some external components to catch the change\n\t\t\tcountry.dispatchEvent( new CustomEvent( 'change' ), { 'bubbles': true } );\n\t\t}\n\n\t\t// Update state value\n\t\tif ( state && state.value != data.state_short ) {\n\t\t\tif ( hasJQuery && $( state ).data( 'select2' ) ) {\n\t\t\t\t// State is a select2 so it needs to trigger jQuery event\n\t\t\t\t$( state ).val( data.state_short ).trigger( 'change' );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tstate.value = data.state_short;\n\t\t\t}\n\n\t\t\t// Need to dispatch native event for some external components to catch the change\n\t\t\tstate.dispatchEvent( new CustomEvent( 'change' ), { 'bubbles': true } );\n\t\t}\n\t};\n\n\n\n\t/**\n\t * Trigger ziptastic api to get zip data.\n\t * @param  {String} zip Zip or postcode.\n\t */\n\tvar triggerAutocomplete = function( target, zip ) {\n\t\t// Bail if api_key not defined\n\t\tif ( ! ziptasticAPIKey ) { return; }\n\t\t\n\t\tvar wrapper = target.closest( fieldWrappers );\n\t\tvar countryField = wrapper.querySelector( countryFields );\n\t\t\n\t\t// Default to US\n\t\tvar country = 'US';\n\n\t\t// Try get country from form field\n\t\tif ( countryField && countryField.value != '' ) {\n\t\t\tcountry = countryField.value;\n\t\t}\n\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.open('GET', '//zip.getziptastic.com/v3/'+country+'/'+zip);\n\t\txhr.setRequestHeader('Content-Type', 'application/json');\n\t\txhr.setRequestHeader('x-key', ziptasticAPIKey);\n\t\txhr.onload = function() {\n\t\t\tif ( xhr.status === 200 ) {\n\t\t\t\tvar data = JSON.parse( xhr.responseText );\n\t\t\t\tprocessAutocomplete( target, data[0] );\n\t\t\t}\n\t\t};\n\t\txhr.send();\n\t};\n\n\t\n\n\t/**\n\t * Maybe trigger ziptastic api, check if field has enough chars.\n\t * @param  {Event} e Event data.\n\t */\n\tvar maybeTriggerAutocomplete = function( e ) {\n\t\t// Bail if api_key not defined\n\t\tif ( ! ziptasticAPIKey ) { return; }\n\n\t\t// Bail if target not defined\n\t\tif ( ! e.target ) { return; }\n\n\t\t// Bail some keys where presses\n\t\tvar skipKeys = [\n\t\t\t9, // Tab\n\t\t\t27, // Esc\n\t\t];\n\t\tif ( e.type == 'keyup' && skipKeys.includes( e.keyCode ) ) { return; }\n\n\t\tvar value = e.target.value;\n\n\t\t// Check if field has enough chars\n\t\tif ( value.length < minChars ) { return; }\n\n\t\ttriggerAutocomplete( e.target, value );\n\t};\n\n\n\n\t/**\n\t * Handle captured keyup event and route to appropriate function.\n\t * @param  {Event} e Event data.\n\t */\n\tvar handleTriggerEvents = function( e ) {\n\t\tif ( e.target.matches( zipFields ) ) {\n\t\t\tmaybeTriggerAutocomplete( e );\n\t\t}\n\t};\n\n\n\n\tvar init = function() {\n\t\t// Bail if server defined vars not found\n\t\tif ( ! ziptasticVars ) { return; }\n\n\t\tziptasticAPIKey = ziptasticVars.api_key;\n\t};\n\n\n\t// Add event listeners\n\twindow.addEventListener( 'load', init );\n\twindow.addEventListener( 'keyup', handleTriggerEvents, true );\n\twindow.addEventListener( 'change', handleTriggerEvents, true );\n\n})( jQuery );\n"],"names":["$","triggerAutocomplete","target","zip","countryField","country","xhr","ziptasticAPIKey","closest","fieldWrappers","querySelector","countryFields","value","XMLHttpRequest","open","setRequestHeader","onload","data","city","state","wrapper","status","JSON","parse","responseText","dispatchEvent","CustomEvent","bubbles","hasJQuery","val","trigger","state_short","send","handleTriggerEvents","e","matches","type","includes","keyCode","length","window","addEventListener","ziptasticVars","api_key","jQuery"],"mappings":"CAIA,SAAWA,gBA+EgB,SAAtBC,EAAgCC,EAAQC,GAE3C,IAGIC,EAGAC,EAOAC,EAbGC,IAMHF,EAAU,MAHVD,EADUF,EAAOM,QAASC,GACHC,cAAeC,KAMC,IAAtBP,EAAaQ,QACjCP,EAAUD,EAAaQ,QAGpBN,EAAM,IAAIO,gBACVC,KAAK,MAAO,6BAA6BT,EAAQ,IAAIF,GACzDG,EAAIS,iBAAiB,eAAgB,oBACrCT,EAAIS,iBAAiB,QAASR,GAC9BD,EAAIU,OAAS,WACZ,IACKC,EAxE6Bf,EAAQe,EAMvCC,EACFC,EACAd,EAPEe,EAsEiB,MAAfd,EAAIe,SACJJ,EAAOK,KAAKC,MAAOjB,EAAIkB,cAxEMtB,EAyEZA,EAzEoBe,EAyEZA,EAAK,IAxEhCG,EAAUlB,EAAOM,QAASC,MAK1BS,EAAOE,EAAQV,cAvBN,iCAwBXS,EAAQC,EAAQV,cAvBJ,mCAwBZL,EAAUe,EAAQV,cAAeC,GAG9BO,GAAQA,EAAKN,OAASK,EAAKC,OAC/BA,EAAKN,MAAQK,EAAKC,KAClBA,EAAKO,cAAe,IAAIC,YAAa,UAAY,CAAEC,SAAW,KAI1DtB,GAAWA,EAAQO,OAASK,EAAKZ,UAChCuB,GAAa5B,EAAGK,GAAUY,KAAM,WAEpCjB,EAAGK,GAAUwB,IAAKZ,EAAKZ,SAAUyB,QAAS,UAG1CzB,EAAQO,MAAQK,EAAKZ,QAItBA,EAAQoB,cAAe,IAAIC,YAAa,UAAY,CAAEC,SAAW,KAI7DR,GAASA,EAAMP,OAASK,EAAKc,cAC5BH,GAAa5B,EAAGmB,GAAQF,KAAM,WAElCjB,EAAGmB,GAAQU,IAAKZ,EAAKc,aAAcD,QAAS,UAG5CX,EAAMP,MAAQK,EAAKc,YAIpBZ,EAAMM,cAAe,IAAIC,YAAa,UAAY,CAAEC,SAAW,QAmChErB,EAAI0B,QAqCqB,SAAtBC,EAAgCC,GA5BL,IAAUA,EAcpCtB,EAeCsB,EAAEhC,OAAOiC,QArIF,2CAwG4BD,EA8BbA,EA5BpB3B,GAGA2B,EAAEhC,SAOM,SAAVgC,EAAEE,MAJQ,CACd,EACA,IAEkCC,SAAUH,EAAEI,YAE3C1B,EAAQsB,EAAEhC,OAAOU,OAGV2B,OApHA,GAsHXtC,EAAqBiC,EAAEhC,OAAQU,MA7HhC,IAAIgB,EAAmB,MAAL5B,EACjBO,GAAkB,EAElBE,EAAgB,sIAGhBE,EAAgB,sCAiJjB6B,OAAOC,iBAAkB,OATd,WAEHC,gBAEPnC,EAAkBmC,cAAcC,WAMjCH,OAAOC,iBAAkB,QAASR,GAAqB,GACvDO,OAAOC,iBAAkB,SAAUR,GAAqB,GAhKzD,CAkKIW"}