{"version":3,"file":"../checkout-125-beta-1.min.js","sources":["checkout-125-beta-1.js"],"sourcesContent":["/**\n * Checkout Script\n * \n * Replaces the original WooCommerce `checkout.js`.\n */\n\n/* global wc_checkout_params */\njQuery( function( $ ) {\n\n\t// wc_checkout_params is required to continue, ensure the object exists\n\tif ( typeof wc_checkout_params === 'undefined' ) {\n\t\treturn false;\n\t}\n\n\t$.blockUI.defaults.overlayCSS.cursor = 'default';\n\n\t// CHANGE: Add custom css selectors for place order button and terms checkbox\n\tvar _place_order_selector = '#place_order, .fc-place-order-button';\n\tvar _terms_selector = '.fc-terms-checkbox';\n\tvar _updateBeforeUnload = false;\n\n\n\tvar wc_checkout_form = {\n\t\tupdateTimer: false,\n\t\tdirtyInput: false,\n\t\tselectedPaymentMethod: false,\n\t\txhr: false,\n\t\t$order_review: $( '#order_review' ),\n\t\t$checkout_form: $( 'form.checkout' ),\n\t\tinit: function() {\n\t\t\t$( document.body ).on( 'update_checkout', this.update_checkout );\n\t\t\t$( document.body ).on( 'init_checkout', this.init_checkout );\n\n\t\t\t// Payment methods\n\t\t\tthis.$checkout_form.on( 'click', 'input[name=\"payment_method\"]', this.payment_method_selected );\n\n\t\t\tif ( $( document.body ).hasClass( 'woocommerce-order-pay' ) ) {\n\t\t\t\tthis.$order_review.on( 'click', 'input[name=\"payment_method\"]', this.payment_method_selected );\n\t\t\t\tthis.$order_review.on( 'submit', this.submitOrder );\n\t\t\t\tthis.$order_review.attr( 'novalidate', 'novalidate' );\n\t\t\t}\n\n\t\t\t// Prevent HTML5 validation which can conflict.\n\t\t\tthis.$checkout_form.attr( 'novalidate', 'novalidate' );\n\n\t\t\t// Form submission\n\t\t\tthis.$checkout_form.on( 'submit', this.submit );\n\n\t\t\t// Inline validation\n\t\t\tthis.$checkout_form.on( 'input validate change', '.input-text, select, input:checkbox', this.validate_field );\n\n\t\t\t// Manual trigger\n\t\t\tthis.$checkout_form.on( 'update', this.trigger_update_checkout );\n\n\t\t\t// Inputs/selects which update totals\n\t\t\t// CHANGE: Removed selector `#ship-to-different-address input`\n\t\t\tthis.$checkout_form.on( 'change', 'select.shipping_method, input[name^=\"shipping_method\"], .update_totals_on_change select, .update_totals_on_change input[type=\"radio\"], .update_totals_on_change input[type=\"checkbox\"]', this.trigger_update_checkout ); // eslint-disable-line max-len\n\t\t\tthis.$checkout_form.on( 'change', '.address-field select', this.input_changed );\n\t\t\t// CHANGE: Prevent billing address fields change from updating checkout\n\t\t\tthis.$checkout_form.on( 'change', '.woocommerce-shipping-fields__field-wrapper .address-field input.input-text, .update_totals_on_change input.input-text', this.maybe_input_changed ); // eslint-disable-line max-len\n\t\t\t// CHANGE: Prevent billing address fields change from updating checkout\n\t\t\tthis.$checkout_form.on( 'keydown', '.woocommerce-shipping-fields__field-wrapper .address-field input.input-text, .update_totals_on_change input.input-text', this.queue_update_checkout ); // eslint-disable-line max-len\n\n\t\t\t// Address fields\n\t\t\t// CHANGE: Removed shipping to different address checkout `change` listener\n\n\t\t\t// CHANGE: Update checkout totals to save data to session when user switches tabs, apps, goes to homescreen, etc.\n\t\t\tdocument.addEventListener( 'visibilitychange', this.maybe_update_checkout_visibility_change );\n\n\t\t\t// CHANGE: Maybe prevent `unload` after they change fields in the page\n\t\t\tthis.$checkout_form.on( 'change', 'select, input, textarea', this.maybe_prevent_unload );\n\n\t\t\t// CHANGE: Update checkout when \"billing same as shipping\" checked state changes\n\t\t\tthis.$checkout_form.on( 'change', '#billing_same_as_shipping', this.billing_same_shipping_changed );\n\t\t\t$( document.body ).on( 'updated_checkout', this.maybe_reinitialize_collapsible_blocks );\n\n\t\t\t// CHANGE: Maybe hide shipping address substep edit buttons\n\t\t\t$( document.body ).on( 'updated_checkout', this.maybe_change_shipping_address_edit_button_visibility );\n\n\t\t\t// CHANGE: Add event listener to sync terms checkbox state\n\t\t\tthis.$checkout_form.on( 'change', _terms_selector, this.terms_checked_changed );\n\n\t\t\t// Trigger events\n\t\t\t// CHANGE: Removed shipping to different address checkout `change` trigger\n\t\t\tthis.init_payment_methods();\n\n\t\t\t// Update on page load\n\t\t\tif ( wc_checkout_params.is_checkout === '1' ) {\n\t\t\t\t$( document.body ).trigger( 'init_checkout' );\n\t\t\t}\n\t\t\tif ( wc_checkout_params.option_guest_checkout === 'yes' ) {\n\t\t\t\t$( 'input#createaccount' ).on( 'change', this.toggle_create_account ).trigger( 'change' );\n\t\t\t}\n\t\t},\n\t\t// CHANGE: Update checkout when \"billing same as shipping\" checked state changes\n\t\tbilling_same_shipping_changed: function( e ) {\n\t\t\tif ( window.CollapsibleBlock ) {\n\t\t\t\tvar checkbox = document.querySelector( '#billing_same_as_shipping' );\n\t\t\t\tvar fieldsWrapper = document.querySelector( '#woocommerce-billing-fields__field-wrapper' );\n\n\t\t\t\t// Toggle state\n\t\t\t\tif ( ! checkbox.checked ) {\n\t\t\t\t\tCollapsibleBlock.expand( fieldsWrapper );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tCollapsibleBlock.collapse( fieldsWrapper );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$( document.body ).trigger( 'update_checkout' );\n\t\t},\n\t\t// CHANGE: Reinitialize billing fields collapsible block after checkout update\n\t\tmaybe_reinitialize_collapsible_blocks: function() {\n\t\t\tif ( window.CollapsibleBlock ) {\n\t\t\t\tvar collapsibleBlocks = document.querySelectorAll( '[data-collapsible]' );\n\t\t\t\tfor ( var i = 0; i < collapsibleBlocks.length; i++ ) {\n\t\t\t\t\tvar collapsibleBlock = collapsibleBlocks[i];\n\t\t\t\t\t\n\t\t\t\t\t// Maybe initialize the collapsible block\n\t\t\t\t\tif ( ! CollapsibleBlock.getInstance( collapsibleBlock ) ) {\n\t\t\t\t\t\tCollapsibleBlock.initializeElement( collapsibleBlock );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// CHANGE: Maybe change visibility status of the shipping address edit buttons\n\t\tmaybe_change_shipping_address_edit_button_visibility: function() {\n\t\t\tvar $packages = $( '.shipping-method__package' );\n\t\t\tif ( $packages.length ) {\n\t\t\t\t$packages.each( function() {\n\n\t\t\t\t\tvar $chosen_method = $( this ).find( 'input.shipping_method:checked' );\n\t\t\t\t\tvar $shipping_address_substep = $( '.fc-step__substep[data-substep-id=\"shipping_address\"]' );\n\t\t\t\t\tvar is_local_pickup = $chosen_method.val().startsWith( 'local_pickup' );\n\t\t\t\t\t\n\t\t\t\t\t// TODO: Manage multiple shipping packages\n\t\t\t\t\tif( is_local_pickup ) {\n\t\t\t\t\t\t$shipping_address_substep.addClass( 'has-local-pickup-selected' );\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$shipping_address_substep.removeClass( 'has-local-pickup-selected' );\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\t// CHANGE: Update checkout when page gets hidden\n\t\tmaybe_update_checkout_visibility_change: function() {\n\t\t\tif ( document.visibilityState == 'hidden' ) {\n\t\t\t\t$( document.body ).trigger( 'update_checkout' );\n\t\t\t}\n\t\t},\n\t\t// CHANGE: Prompt user that they might lose data when closing tab or leaving the current page after they change some values in the checkout form\n\t\tmaybe_prevent_unload: function( e ) {\n\t\t\t// Ignore some fields\n\t\t\tif ( e && e.target.closest( '.payment_box, input#createaccount' ) ) { return; }\n\n\t\t\tif ( ! _updateBeforeUnload ) {\n\n\t\t\t\tvar preventUnload = function( e ) {\n\t\t\t\t\t// Prompt user if there is unsaved data\n\t\t\t\t\tif ( _updateBeforeUnload ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.returnValue = '';\n\t\n\t\t\t\t\t\t// Proceed to update the checkout totals if the user cancel the event\n\t\t\t\t\t\t$( document.body ).trigger( 'update_checkout' );\n\n\t\t\t\t\t\t// Reset flag to update on `beforeunload`\n\t\t\t\t\t\t_updateBeforeUnload = false;\n\t\t\t\t\t\twindow.removeEventListener( 'beforeunload', preventUnload );\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\twindow.addEventListener( 'beforeunload', preventUnload );\n\t\t\t\t_updateBeforeUnload = true;\n\t\t\t}\n\t\t},\n\t\tinit_payment_methods: function() {\n\t\t\tvar $payment_methods = $( '.woocommerce-checkout' ).find( 'input[name=\"payment_method\"]' );\n\n\t\t\t// If there is one method, we can hide the radio input\n\t\t\tif ( 1 === $payment_methods.length ) {\n\t\t\t\t$payment_methods.eq(0).hide();\n\t\t\t}\n\n\t\t\t// If there was a previously selected method, check that one.\n\t\t\tif ( wc_checkout_form.selectedPaymentMethod ) {\n\t\t\t\t$( '#' + wc_checkout_form.selectedPaymentMethod ).prop( 'checked', true );\n\t\t\t}\n\n\t\t\t// If there are none selected, select the first.\n\t\t\tif ( 0 === $payment_methods.filter( ':checked' ).length ) {\n\t\t\t\t$payment_methods.eq(0).prop( 'checked', true );\n\t\t\t}\n\n\t\t\t// Get name of new selected method.\n\t\t\tvar checkedPaymentMethod = $payment_methods.filter( ':checked' ).eq(0).prop( 'id' );\n\n\t\t\tif ( $payment_methods.length > 1 ) {\n\t\t\t\t// Hide open descriptions.\n\t\t\t\t$( 'div.payment_box:not(\".' + checkedPaymentMethod + '\")' ).filter( ':visible' ).slideUp( 0 );\n\t\t\t}\n\n\t\t\t// Trigger click event for selected method\n\t\t\t$payment_methods.filter( ':checked' ).eq(0).trigger( 'click' );\n\t\t},\n\t\tget_payment_method: function() {\n\t\t\treturn wc_checkout_form.$checkout_form.find( 'input[name=\"payment_method\"]:checked' ).val();\n\t\t},\n\t\tpayment_method_selected: function( e ) {\n\t\t\te.stopPropagation();\n\n\t\t\tif ( $( '.payment_methods input.input-radio' ).length > 1 ) {\n\t\t\t\tvar target_payment_box = $( 'div.payment_box.' + $( this ).attr( 'ID' ) ),\n\t\t\t\t\tis_checked         = $( this ).is( ':checked' );\n\n\t\t\t\tif ( is_checked && ! target_payment_box.is( ':visible' ) ) {\n\t\t\t\t\t$( 'div.payment_box' ).filter( ':visible' ).slideUp( 230 );\n\n\t\t\t\t\tif ( is_checked ) {\n\t\t\t\t\t\ttarget_payment_box.slideDown( 230 );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$( 'div.payment_box' ).show();\n\t\t\t}\n\n\t\t\tif ( $( this ).data( 'order_button_text' ) ) {\n\t\t\t\t// CHANGE: replaced the place order button css selector with an extended custom selector\n\t\t\t\t$( _place_order_selector ).text( $( this ).data( 'order_button_text' ) );\n\t\t\t} else {\n\t\t\t\t// CHANGE: replaced the place order button css selector with an extended custom selector\n\t\t\t\t$( _place_order_selector ).text( $( _place_order_selector ).data( 'value' ) );\n\t\t\t}\n\n\t\t\tvar selectedPaymentMethod = $( '.woocommerce-checkout input[name=\"payment_method\"]:checked' ).attr( 'id' );\n\n\t\t\tif ( selectedPaymentMethod !== wc_checkout_form.selectedPaymentMethod ) {\n\t\t\t\t$( document.body ).trigger( 'payment_method_selected' );\n\t\t\t}\n\n\t\t\twc_checkout_form.selectedPaymentMethod = selectedPaymentMethod;\n\t\t},\n\t\ttoggle_create_account: function() {\n\t\t\t$( 'div.create-account' ).hide();\n\n\t\t\tif ( $( this ).is( ':checked' ) ) {\n\t\t\t\t// Ensure password is not pre-populated.\n\t\t\t\t$( '#account_password' ).val( '' ).trigger( 'change' );\n\t\t\t\t$( 'div.create-account' ).slideDown();\n\t\t\t}\n\t\t},\n\t\tinit_checkout: function() {\n\t\t\t$( document.body ).trigger( 'update_checkout' );\n\t\t},\n\t\tmaybe_input_changed: function( e ) {\n\t\t\tif ( wc_checkout_form.dirtyInput ) {\n\t\t\t\twc_checkout_form.input_changed( e );\n\t\t\t}\n\t\t},\n\t\t// CHANGE: Add function to sync the terms checkbox state\n\t\tterms_checked_changed: function( e ) {\n\t\t\tvar termsCheckBoxChecked = $( e.target ).prop( 'checked' );\n\t\t\t$( _terms_selector ).prop( 'checked', termsCheckBoxChecked );\n\t\t},\n\t\tinput_changed: function( e ) {\n\t\t\twc_checkout_form.dirtyInput = e.target;\n\t\t\twc_checkout_form.maybe_update_checkout();\n\t\t},\n\t\tqueue_update_checkout: function( e ) {\n\t\t\tvar code = e.keyCode || e.which || 0;\n\n\t\t\tif ( code === 9 ) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\twc_checkout_form.dirtyInput = this;\n\t\t\twc_checkout_form.reset_update_checkout_timer();\n\t\t\twc_checkout_form.updateTimer = setTimeout( wc_checkout_form.maybe_update_checkout, '1000' );\n\t\t},\n\t\ttrigger_update_checkout: function() {\n\t\t\twc_checkout_form.reset_update_checkout_timer();\n\t\t\twc_checkout_form.dirtyInput = false;\n\t\t\t$( document.body ).trigger( 'update_checkout' );\n\t\t},\n\t\tmaybe_update_checkout: function() {\n\t\t\tvar update_totals = true;\n\n\t\t\tif ( $( wc_checkout_form.dirtyInput ).length ) {\n\t\t\t\tvar $required_inputs = $( wc_checkout_form.dirtyInput ).closest( 'div' ).find( '.address-field.validate-required' );\n\n\t\t\t\tif ( $required_inputs.length ) {\n\t\t\t\t\t$required_inputs.each( function() {\n\t\t\t\t\t\tif ( $( this ).find( 'input.input-text' ).val() === '' ) {\n\t\t\t\t\t\t\tupdate_totals = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( update_totals ) {\n\t\t\t\twc_checkout_form.trigger_update_checkout();\n\t\t\t}\n\t\t},\n        // CHANGE: Removed shipping to different address checkout `change` listener handler function\n\t\treset_update_checkout_timer: function() {\n\t\t\tclearTimeout( wc_checkout_form.updateTimer );\n\t\t},\n\t\tis_valid_json: function( raw_json ) {\n\t\t\ttry {\n\t\t\t\tvar json = JSON.parse( raw_json );\n\n\t\t\t\treturn ( json && 'object' === typeof json );\n\t\t\t} catch ( e ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tvalidate_field: function( e ) {\n\t\t\tvar $this             = $( this ),\n\t\t\t\t$parent           = $this.closest( '.form-row' ),\n\t\t\t\tvalidated         = true,\n\t\t\t\tvalidate_required = $parent.is( '.validate-required' ),\n\t\t\t\tvalidate_email    = $parent.is( '.validate-email' ),\n\t\t\t\tvalidate_phone    = $parent.is( '.validate-phone' ),\n\t\t\t\tpattern           = '',\n\t\t\t\tevent_type        = e.type;\n\n\t\t\tif ( 'input' === event_type ) {\n\t\t\t\t$parent.removeClass( 'woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email woocommerce-invalid-phone woocommerce-validated' ); // eslint-disable-line max-len\n\t\t\t}\n\n\t\t\tif ( 'validate' === event_type || 'change' === event_type ) {\n\n\t\t\t\tif ( validate_required ) {\n\t\t\t\t\tif ( 'checkbox' === $this.attr( 'type' ) && ! $this.is( ':checked' ) ) {\n\t\t\t\t\t\t$parent.removeClass( 'woocommerce-validated' ).addClass( 'woocommerce-invalid woocommerce-invalid-required-field' );\n\t\t\t\t\t\tvalidated = false;\n\t\t\t\t\t} else if ( $this.val() === '' ) {\n\t\t\t\t\t\t$parent.removeClass( 'woocommerce-validated' ).addClass( 'woocommerce-invalid woocommerce-invalid-required-field' );\n\t\t\t\t\t\tvalidated = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( validate_email ) {\n\t\t\t\t\tif ( $this.val() ) {\n\t\t\t\t\t\t/* https://stackoverflow.com/questions/2855865/jquery-validate-e-mail-address-regex */\n\t\t\t\t\t\tpattern = new RegExp( /^([a-z\\d!#$%&'*+\\-\\/=?^_`{|}~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]+(\\.[a-z\\d!#$%&'*+\\-\\/=?^_`{|}~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]+)*|\"((([ \\t]*\\r\\n)?[ \\t]+)?([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f\\x21\\x23-\\x5b\\x5d-\\x7e\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))*(([ \\t]*\\r\\n)?[ \\t]+)?\")@(([a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|[a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF][a-z\\d\\-._~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]*[a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])\\.)+([a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|[a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF][a-z\\d\\-._~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]*[0-9a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])\\.?$/i ); // eslint-disable-line max-len\n\n\t\t\t\t\t\tif ( ! pattern.test( $this.val() ) ) {\n\t\t\t\t\t\t\t$parent.removeClass( 'woocommerce-validated' ).addClass( 'woocommerce-invalid woocommerce-invalid-email woocommerce-invalid-phone' ); // eslint-disable-line max-len\n\t\t\t\t\t\t\tvalidated = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( validate_phone ) {\n\t\t\t\t\tpattern = new RegExp( /[\\s\\#0-9_\\-\\+\\/\\(\\)\\.]/g );\n\n\t\t\t\t\tif ( 0 < $this.val().replace( pattern, '' ).length ) {\n\t\t\t\t\t\t$parent.removeClass( 'woocommerce-validated' ).addClass( 'woocommerce-invalid woocommerce-invalid-phone' );\n\t\t\t\t\t\tvalidated = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( validated ) {\n\t\t\t\t\t$parent.removeClass( 'woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email woocommerce-invalid-phone' ).addClass( 'woocommerce-validated' ); // eslint-disable-line max-len\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tupdate_checkout: function( event, args ) {\n\t\t\t// Small timeout to prevent multiple requests when several fields update at the same time\n\t\t\twc_checkout_form.reset_update_checkout_timer();\n\t\t\twc_checkout_form.updateTimer = setTimeout( wc_checkout_form.update_checkout_action, '5', args );\n\t\t},\n\t\tupdate_checkout_action: function( args ) {\n\t\t\tif ( wc_checkout_form.xhr ) {\n\t\t\t\twc_checkout_form.xhr.abort();\n\t\t\t}\n\n\t\t\tif ( $( 'form.checkout' ).length === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\targs = typeof args !== 'undefined' ? args : {\n\t\t\t\tupdate_shipping_method: true\n\t\t\t};\n\n\t\t\tvar country\t\t\t = $( '#billing_country' ).val(),\n\t\t\t\tstate\t\t\t = $( '#billing_state' ).val(),\n\t\t\t\tpostcode\t\t = $( ':input#billing_postcode' ).val(),\n\t\t\t\tcity\t\t\t = $( '#billing_city' ).val(),\n\t\t\t\taddress\t\t\t = $( ':input#billing_address_1' ).val(),\n\t\t\t\taddress_2\t\t = $( ':input#billing_address_2' ).val(),\n\t\t\t\t// CHANGE: Always get shipping address values from shipping fields\n\t\t\t\ts_country\t\t = $( '#shipping_country' ).val(),\n\t\t\t\ts_state\t\t\t = $( '#shipping_state' ).val(),\n\t\t\t\ts_postcode\t\t = $( ':input#shipping_postcode' ).val(),\n\t\t\t\ts_city\t\t\t = $( '#shipping_city' ).val(),\n\t\t\t\ts_address\t\t = $( ':input#shipping_address_1' ).val(),\n\t\t\t\ts_address_2\t\t = $( ':input#shipping_address_2' ).val(),\n\t\t\t\t// END - CHANGE: Always get shipping address values from shipping fields\n\t\t\t\t$required_inputs = $( wc_checkout_form.$checkout_form ).find( '.address-field.validate-required:visible' ),\n\t\t\t\thas_full_address = true;\n\n\t\t\tif ( $required_inputs.length ) {\n\t\t\t\t$required_inputs.each( function() {\n\t\t\t\t\tif ( $( this ).find( ':input' ).val() === '' ) {\n\t\t\t\t\t\thas_full_address = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n            // CHANGE: Removed if handling of different shipping address checkbox, always get shipping address values from shipping fields (see above)\n\n\t\t\tvar data = {\n\t\t\t\tsecurity        : wc_checkout_params.update_order_review_nonce,\n\t\t\t\tpayment_method  : wc_checkout_form.get_payment_method(),\n\t\t\t\tcountry         : country,\n\t\t\t\tstate           : state,\n\t\t\t\tpostcode        : postcode,\n\t\t\t\tcity            : city,\n\t\t\t\taddress         : address,\n\t\t\t\taddress_2       : address_2,\n\t\t\t\ts_country       : s_country,\n\t\t\t\ts_state         : s_state,\n\t\t\t\ts_postcode      : s_postcode,\n\t\t\t\ts_city          : s_city,\n\t\t\t\ts_address       : s_address,\n\t\t\t\ts_address_2     : s_address_2,\n\t\t\t\thas_full_address: has_full_address,\n\t\t\t\tpost_data       : $( 'form.checkout' ).serialize()\n\t\t\t};\n\n\t\t\tif ( false !== args.update_shipping_method ) {\n\t\t\t\tvar shipping_methods = {};\n\n\t\t\t\t// eslint-disable-next-line max-len\n\t\t\t\t$( 'select.shipping_method, input[name^=\"shipping_method\"][type=\"radio\"]:checked, input[name^=\"shipping_method\"][type=\"hidden\"]' ).each( function() {\n\t\t\t\t\tshipping_methods[ $( this ).data( 'index' ) ] = $( this ).val();\n\t\t\t\t} );\n\n\t\t\t\tdata.shipping_method = shipping_methods;\n\t\t\t}\n\n\t\t\t// CHANGE: Also block the billing address fields and shipping methods\n\t\t\t$( '.woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, .woocommerce-billing-fields, .fc-shipping-method__packages' ).block({\n\t\t\t\tmessage: null,\n\t\t\t\toverlayCSS: {\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\topacity: 0.6\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twc_checkout_form.xhr = $.ajax({\n\t\t\t\ttype:\t\t'POST',\n\t\t\t\turl:\t\twc_checkout_params.wc_ajax_url.toString().replace( '%%endpoint%%', 'update_order_review' ),\n\t\t\t\tdata:\t\tdata,\n\t\t\t\tsuccess:\tfunction( data ) {\n\n\t\t\t\t\t// Reload the page if requested\n\t\t\t\t\tif ( data && true === data.reload ) {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove any notices added previously\n\t\t\t\t\t$( '.woocommerce-NoticeGroup-updateOrderReview' ).remove();\n\n\t\t\t\t\t// CHANGE: replaced the terms checkbox css selector\n\t\t\t\t\tvar termsCheckBoxChecked = $( _terms_selector ).prop( 'checked' );\n\n\t\t\t\t\t// Save payment details to a temporary object\n\t\t\t\t\tvar paymentDetails = {};\n\t\t\t\t\t$( '.payment_box :input' ).each( function() {\n\t\t\t\t\t\tvar ID = $( this ).attr( 'id' );\n\n\t\t\t\t\t\tif ( ID ) {\n\t\t\t\t\t\t\tif ( $.inArray( $( this ).attr( 'type' ), [ 'checkbox', 'radio' ] ) !== -1 ) {\n\t\t\t\t\t\t\t\tpaymentDetails[ ID ] = $( this ).prop( 'checked' );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpaymentDetails[ ID ] = $( this ).val();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// CHANGE: Get current element with focus, will reset after updating the fragments\n\t\t\t\t\tvar currentFocusedElement = document.activeElement;\n\t\t\t\t\t\n\t\t\t\t\t// Always update the fragments\n\t\t\t\t\tif ( data && data.fragments ) {\n\t\t\t\t\t\t$.each( data.fragments, function ( key, value ) {\n\t\t\t\t\t\t\tif ( ! wc_checkout_form.fragments || wc_checkout_form.fragments[ key ] !== value ) {\n\t\t\t\t\t\t\t\t$( key ).replaceWith( value );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$( key ).unblock();\n\t\t\t\t\t\t} );\n\t\t\t\t\t\twc_checkout_form.fragments = data.fragments;\n\t\t\t\t\t}\n\n\t\t\t\t\t// CHANGE: Re-set focus to the element with focus previously to updating fragments\n\t\t\t\t\trequestAnimationFrame( function() {\n\t\t\t\t\t\tvar elementToFocus;\n\n\t\t\t\t\t\t// Try findind the the current focused element after updating updated element by ID\n\t\t\t\t\t\tif ( currentFocusedElement.id ) {\n\t\t\t\t\t\t\telementToFocus = document.getElementById( currentFocusedElement.id );\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Try findind the updated element by classes\n\t\t\t\t\t\telse if ( currentFocusedElement.getAttribute( 'name' ) ) {\n\t\t\t\t\t\t\tvar nameAttr = currentFocusedElement.getAttribute( 'name' );\n\t\t\t\t\t\t\telementToFocus = document.querySelector( '[name=\"'+nameAttr+'\"]' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Try findind the `select2` focusable element\n\t\t\t\t\t\telse if ( currentFocusedElement.closest( '.form-row' ) ) {\n\t\t\t\t\t\t\tvar formRow = currentFocusedElement.closest( '.form-row' );\n\t\t\t\t\t\t\tif ( formRow.id ) {\n\t\t\t\t\t\t\t\telementToFocus = document.querySelector( '.form-row[id=\"'+formRow.id+'\"] .select2-selection' );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Try setting focus if element is found\n\t\t\t\t\t\tif ( elementToFocus ) {\n\t\t\t\t\t\t\telementToFocus.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t\t// END - CHANGE: Re-set focus to the element with focus previously to updating fragments\n\n\t\t\t\t\t// Recheck the terms and conditions box, if needed\n\t\t\t\t\tif ( termsCheckBoxChecked ) {\n\t\t\t\t\t\t// CHANGE: replaced the terms checkbox css selector\n\t\t\t\t\t\t$( _terms_selector ).prop( 'checked', true );\n\t\t\t\t\t}\n\n\t\t\t\t\t// Fill in the payment details if possible without overwriting data if set.\n\t\t\t\t\tif ( ! $.isEmptyObject( paymentDetails ) ) {\n\t\t\t\t\t\t$( '.payment_box :input' ).each( function() {\n\t\t\t\t\t\t\tvar ID = $( this ).attr( 'id' );\n\t\t\t\t\t\t\tif ( ID ) {\n\t\t\t\t\t\t\t\tif ( $.inArray( $( this ).attr( 'type' ), [ 'checkbox', 'radio' ] ) !== -1 ) {\n\t\t\t\t\t\t\t\t\t$( this ).prop( 'checked', paymentDetails[ ID ] ).trigger( 'change' );\n\t\t\t\t\t\t\t\t} else if ( $.inArray( $( this ).attr( 'type' ), [ 'select' ] ) !== -1 ) {\n\t\t\t\t\t\t\t\t\t$( this ).val( paymentDetails[ ID ] ).trigger( 'change' );\n\t\t\t\t\t\t\t\t} else if ( null !== $( this ).val() && 0 === $( this ).val().length ) {\n\t\t\t\t\t\t\t\t\t$( this ).val( paymentDetails[ ID ] ).trigger( 'change' );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check for error\n\t\t\t\t\tif ( data && 'failure' === data.result ) {\n\n\t\t\t\t\t\tvar $form = $( 'form.checkout' );\n\n\t\t\t\t\t\t// Remove notices from all sources\n\t\t\t\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\n\n\t\t\t\t\t\t// Add new errors returned by this event\n\t\t\t\t\t\tif ( data.messages ) {\n\t\t\t\t\t\t\t$form.prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview\">' + data.messages + '</div>' ); // eslint-disable-line max-len\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$form.prepend( data );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Lose focus for all fields\n\t\t\t\t\t\t$form.find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).trigger( 'blur' );\n\n\t\t\t\t\t\twc_checkout_form.scroll_to_notices();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Re-init methods\n\t\t\t\t\twc_checkout_form.init_payment_methods();\n\n\t\t\t\t\t// CHANGE: Set to not prompt user before leaving the page\n\t\t\t\t\t_updateBeforeUnload = false;\n\n\t\t\t\t\t// Fire updated_checkout event.\n\t\t\t\t\t$( document.body ).trigger( 'updated_checkout', [ data ] );\n\t\t\t\t}\n\n\t\t\t});\n\t\t},\n\t\thandleUnloadEvent: function( e ) {\n\t\t\t// Modern browsers have their own standard generic messages that they will display.\n\t\t\t// Confirm, alert, prompt or custom message are not allowed during the unload event\n\t\t\t// Browsers will display their own standard messages\n\n\t\t\t// Check if the browser is Internet Explorer\n\t\t\tif((navigator.userAgent.indexOf('MSIE') !== -1 ) || (!!document.documentMode)) {\n\t\t\t\t// IE handles unload events differently than modern browsers\n\t\t\t\te.preventDefault();\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tattachUnloadEventsOnSubmit: function() {\n\t\t\t$( window ).on('beforeunload', this.handleUnloadEvent);\n\t\t},\n\t\tdetachUnloadEventsOnSubmit: function() {\n\t\t\t$( window ).off('beforeunload', this.handleUnloadEvent);\n\t\t},\n\t\tblockOnSubmit: function( $form ) {\n\t\t\tvar isBlocked = $form.data( 'blockUI.isBlocked' );\n\n\t\t\tif ( 1 !== isBlocked ) {\n\t\t\t\t$form.block({\n\t\t\t\t\tmessage: null,\n\t\t\t\t\toverlayCSS: {\n\t\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\t\topacity: 0.6\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tsubmitOrder: function() {\n\t\t\twc_checkout_form.blockOnSubmit( $( this ) );\n\t\t},\n\t\tsubmit: function() {\n\t\t\twc_checkout_form.reset_update_checkout_timer();\n\t\t\tvar $form = $( this );\n\n\t\t\tif ( $form.is( '.processing' ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// CHANGE: Reset flag to update on `beforeunload`\n\t\t\t_updateBeforeUnload = false;\n\n\t\t\t// Trigger a handler to let gateways manipulate the checkout if needed\n\t\t\t// eslint-disable-next-line max-len\n\t\t\tif ( $form.triggerHandler( 'checkout_place_order' ) !== false && $form.triggerHandler( 'checkout_place_order_' + wc_checkout_form.get_payment_method() ) !== false ) {\n\n\t\t\t\t$form.addClass( 'processing' );\n\n\t\t\t\twc_checkout_form.blockOnSubmit( $form );\n\n\t\t\t\t// Attach event to block reloading the page when the form has been submitted\n\t\t\t\twc_checkout_form.attachUnloadEventsOnSubmit();\n\n\t\t\t\t// ajaxSetup is global, but we use it to ensure JSON is valid once returned.\n\t\t\t\t$.ajaxSetup( {\n\t\t\t\t\tdataFilter: function( raw_response, dataType ) {\n\t\t\t\t\t\t// We only want to work with JSON\n\t\t\t\t\t\tif ( 'json' !== dataType ) {\n\t\t\t\t\t\t\treturn raw_response;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( wc_checkout_form.is_valid_json( raw_response ) ) {\n\t\t\t\t\t\t\treturn raw_response;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Attempt to fix the malformed JSON\n\t\t\t\t\t\t\tvar maybe_valid_json = raw_response.match( /{\"result.*}/ );\n\n\t\t\t\t\t\t\tif ( null === maybe_valid_json ) {\n\t\t\t\t\t\t\t\tconsole.log( 'Unable to fix malformed JSON' );\n\t\t\t\t\t\t\t} else if ( wc_checkout_form.is_valid_json( maybe_valid_json[0] ) ) {\n\t\t\t\t\t\t\t\tconsole.log( 'Fixed malformed JSON. Original:' );\n\t\t\t\t\t\t\t\tconsole.log( raw_response );\n\t\t\t\t\t\t\t\traw_response = maybe_valid_json[0];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.log( 'Unable to fix malformed JSON' );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn raw_response;\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype:\t\t'POST',\n\t\t\t\t\turl:\t\twc_checkout_params.checkout_url,\n\t\t\t\t\tdata:\t\t$form.serialize(),\n\t\t\t\t\tdataType:   'json',\n\t\t\t\t\tsuccess:\tfunction( result ) {\n\t\t\t\t\t\t// Detach the unload handler that prevents a reload / redirect\n\t\t\t\t\t\twc_checkout_form.detachUnloadEventsOnSubmit();\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif ( 'success' === result.result && $form.triggerHandler( 'checkout_place_order_success', result ) !== false ) {\n\t\t\t\t\t\t\t\tif ( -1 === result.redirect.indexOf( 'https://' ) || -1 === result.redirect.indexOf( 'http://' ) ) {\n\t\t\t\t\t\t\t\t\twindow.location = result.redirect;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\twindow.location = decodeURI( result.redirect );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if ( 'failure' === result.result ) {\n\t\t\t\t\t\t\t\tthrow 'Result failure';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow 'Invalid response';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch( err ) {\n\t\t\t\t\t\t\t// Reload page\n\t\t\t\t\t\t\tif ( true === result.reload ) {\n\t\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Trigger update in case we need a fresh nonce\n\t\t\t\t\t\t\tif ( true === result.refresh ) {\n\t\t\t\t\t\t\t\t$( document.body ).trigger( 'update_checkout' );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Add new errors\n\t\t\t\t\t\t\tif ( result.messages ) {\n\t\t\t\t\t\t\t\twc_checkout_form.submit_error( result.messages );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twc_checkout_form.submit_error( '<div class=\"woocommerce-error\">' + wc_checkout_params.i18n_checkout_error + '</div>' ); // eslint-disable-line max-len\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\terror:\tfunction( jqXHR, textStatus, errorThrown ) {\n\t\t\t\t\t\t// Detach the unload handler that prevents a reload / redirect\n\t\t\t\t\t\twc_checkout_form.detachUnloadEventsOnSubmit();\n\n\t\t\t\t\t\twc_checkout_form.submit_error( '<div class=\"woocommerce-error\">' + errorThrown + '</div>' );\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tsubmit_error: function( error_message ) {\n\t\t\t$( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n\t\t\twc_checkout_form.$checkout_form.prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' + error_message + '</div>' ); // eslint-disable-line max-len\n\t\t\twc_checkout_form.$checkout_form.removeClass( 'processing' ).unblock();\n\t\t\twc_checkout_form.$checkout_form.find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).trigger( 'blur' );\n\t\t\twc_checkout_form.scroll_to_notices();\n\t\t\t$( document.body ).trigger( 'checkout_error' , [ error_message ] );\n\t\t},\n\t\tscroll_to_notices: function() {\n\t\t\tvar scrollElement           = $( '.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout' );\n\n\t\t\tif ( ! scrollElement.length ) {\n\t\t\t\tscrollElement = $( '.form.checkout' );\n\t\t\t}\n\t\t\t$.scroll_to_notices( scrollElement );\n\t\t}\n\t};\n\n\tvar wc_checkout_coupons = {\n\t\tinit: function() {\n\t\t\t$( document.body ).on( 'click', 'a.showcoupon', this.show_coupon_form );\n\t\t\t$( document.body ).on( 'click', '.woocommerce-remove-coupon', this.remove_coupon );\n\t\t\t$( 'form.checkout_coupon' ).hide().on( 'submit', this.submit );\n\t\t\t// CHANGE: Added event listeners for apply coupon via ajax\n\t\t\t$( document.body ).on( 'click', '[data-apply-coupon-button]', this.apply_coupon );\n\t\t\twc_checkout_form.$checkout_form.on( 'keydown', 'input[name=\"coupon_code\"]', this.maybe_apply_coupon_keydown );\n\t\t},\n\t\tshow_coupon_form: function() {\n\t\t\t$( '.checkout_coupon' ).slideToggle( 400, function() {\n\t\t\t\t$( '.checkout_coupon' ).find( ':input:eq(0)' ).trigger( 'focus' );\n\t\t\t});\n\t\t\treturn false;\n\t\t},\n\t\tsubmit: function() {\n\t\t\tvar $form = $( this );\n\n\t\t\tif ( $form.is( '.processing' ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$form.addClass( 'processing' ).block({\n\t\t\t\tmessage: null,\n\t\t\t\toverlayCSS: {\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\topacity: 0.6\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar data = {\n\t\t\t\tsecurity:\t\twc_checkout_params.apply_coupon_nonce,\n\t\t\t\tcoupon_code:\t$form.find( 'input[name=\"coupon_code\"]' ).val()\n\t\t\t};\n\n\t\t\t$.ajax({\n\t\t\t\ttype:\t\t'POST',\n\t\t\t\turl:\t\twc_checkout_params.wc_ajax_url.toString().replace( '%%endpoint%%', 'apply_coupon' ),\n\t\t\t\tdata:\t\tdata,\n\t\t\t\tsuccess:\tfunction( code ) {\n\t\t\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\n\t\t\t\t\t$form.removeClass( 'processing' ).unblock();\n\n\t\t\t\t\tif ( code ) {\n\t\t\t\t\t\t$form.before( code );\n\t\t\t\t\t\t$form.slideUp();\n\n\t\t\t\t\t\t$( document.body ).trigger( 'applied_coupon_in_checkout', [ data.coupon_code ] );\n\t\t\t\t\t\t$( document.body ).trigger( 'update_checkout', { update_shipping_method: false } );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdataType: 'html'\n\t\t\t});\n\n\t\t\treturn false;\n\t\t},\n\t\tremove_coupon: function( e ) {\n\t\t\te.preventDefault();\n\n\t\t\tvar container = $( this ).parents( '.woocommerce-checkout-review-order' ),\n\t\t\t\tcoupon    = $( this ).data( 'coupon' );\n\n\t\t\tcontainer.addClass( 'processing' ).block({\n\t\t\t\tmessage: null,\n\t\t\t\toverlayCSS: {\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\topacity: 0.6\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar data = {\n\t\t\t\tsecurity: wc_checkout_params.remove_coupon_nonce,\n\t\t\t\tcoupon:   coupon\n\t\t\t};\n\n\t\t\t// CHANGE: Display loading/processing indication on the remove coupon button\n\t\t\tvar remove_button   = $( this );\n\t\t\tremove_button.prop( 'disabled', true );\n\t\t\tremove_button.addClass( 'is-loading' );\n\n\t\t\t$.ajax({\n\t\t\t\ttype:    'POST',\n\t\t\t\turl:     wc_checkout_params.wc_ajax_url.toString().replace( '%%endpoint%%', 'remove_coupon' ),\n\t\t\t\tdata:    data,\n\t\t\t\tsuccess: function( code ) {\n\t\t\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\n\t\t\t\t\tcontainer.removeClass( 'processing' ).unblock();\n\n\t\t\t\t\t// CHANGE: Remove loading/processing indication from the remove coupon button\n\t\t\t\t\tremove_button.prop( 'disabled', false );\n\t\t\t\t\tremove_button.removeClass( 'is-loading' );\n\n\t\t\t\t\tif ( code ) {\n\t\t\t\t\t\t// CHANGE: Maybe display coupon code messages in the coupon code step instead of the top of the page\n\t\t\t\t\t\tif ( remove_button.parents( '[data-substep-id=\"coupon_codes\"]' ).length > 0 ) {\n\t\t\t\t\t\t\tremove_button.parents( '[data-substep-id=\"coupon_codes\"]' ).prepend( code );\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t$( 'form.woocommerce-checkout' ).before( code );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$( document.body ).trigger( 'removed_coupon_in_checkout', [ data.coupon_code ] );\n\t\t\t\t\t\t$( document.body ).trigger( 'update_checkout', { update_shipping_method: false } );\n\n\t\t\t\t\t\t// Remove coupon code from coupon field\n\t\t\t\t\t\t$( 'form.checkout_coupon' ).find( 'input[name=\"coupon_code\"]' ).val( '' );\n\n\t\t\t\t\t\t// CHANGE: Remove coupon code from coupon field on the checkout form\n\t\t\t\t\t\t$( 'form.woocommerce-checkout' ).find( 'input[name=\"coupon_code\"]' ).val( '' );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function ( jqXHR ) {\n\t\t\t\t\tif ( wc_checkout_params.debug_mode ) {\n\t\t\t\t\t\t/* jshint devel: true */\n\t\t\t\t\t\tconsole.log( jqXHR.responseText );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdataType: 'html'\n\t\t\t});\n\t\t},\n\t\t// CHANGE: Add function to apply coupon via ajax from the checkout form\n\t\tapply_coupon: function( e ) {\n\t\t\te.preventDefault();\n\n\t\t\tvar coupon_code    = $( 'form.woocommerce-checkout' ).find( 'input[name=\"coupon_code\"]' ).val();\n\t\t\tvar coupon_field   = $( 'form.woocommerce-checkout' ).find( 'input[name=\"coupon_code\"]' );\n\t\t\tvar apply_button   = $( 'form.woocommerce-checkout' ).find( '[data-apply-coupon-button]' );\n\n\t\t\tvar data = {\n\t\t\t\tsecurity: wc_checkout_params.apply_coupon_nonce,\n\t\t\t\tcoupon_code:   coupon_code\n\t\t\t};\n\n\t\t\t// Display loading/processing indication\n\t\t\tcoupon_field.prop( 'disabled', true );\n\t\t\tapply_button.prop( 'disabled', true );\n\t\t\tapply_button.addClass( 'is-loading' );\n\n\t\t\t$.ajax({\n\t\t\t\ttype:    'POST',\n\t\t\t\turl:     wc_checkout_params.wc_ajax_url.toString().replace( '%%endpoint%%', 'apply_coupon' ),\n\t\t\t\tdata:    data,\n\t\t\t\tsuccess: function( code ) {\n\t\t\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\n\t\t\t\t\t\n\t\t\t\t\t// Remove loading/processing indication\n\t\t\t\t\tcoupon_field.prop( 'disabled', false );\n\t\t\t\t\tapply_button.prop( 'disabled', false );\n\t\t\t\t\tapply_button.removeClass( 'is-loading' );\n\n\t\t\t\t\tif ( code ) {\n\t\t\t\t\t\t$( '.fc-step__substep-text-content--coupon-codes' ).before( code );\n\n\t\t\t\t\t\t$( document.body ).trigger( 'applied_coupon_in_checkout', [ data.coupon_code ] );\n\t\t\t\t\t\t$( document.body ).trigger( 'update_checkout', { update_shipping_method: false } );\n\n\t\t\t\t\t\t// Remove coupon code from coupon field\n\t\t\t\t\t\t$( 'form.checkout_coupon' ).find( 'input[name=\"coupon_code\"]' ).val( '' );\n\n\t\t\t\t\t\t// CHANGE: Remove coupon code from coupon field on the checkout form\n\t\t\t\t\t\t$( 'form.woocommerce-checkout' ).find( 'input[name=\"coupon_code\"]' ).val( '' );\n\n\t\t\t\t\t\t// Close the coupon code field section\n\t\t\t\t\t\tif ( window.CollapsibleBlock ) {\n\n\t\t\t\t\t\t\tvar expansibleCouponToggle = document.querySelector( 'form.woocommerce-checkout .fc-expansible-form-section__toggle--coupon_code' );\n\t\t\t\t\t\t\tvar expansibleCouponContent = document.querySelector( 'form.woocommerce-checkout .fc-expansible-form-section__content--coupon_code' );\n\t\t\t\t\t\t\tvar expansibleCouponToggleButton = document.querySelector( 'form.woocommerce-checkout .expansible-section__toggle-plus--coupon_code' );\n\n\t\t\t\t\t\t\tif ( expansibleCouponToggle && expansibleCouponContent ) {\n\t\t\t\t\t\t\t\t// Change expanded/collapsed states for the fields and text blocks\n\t\t\t\t\t\t\t\tCollapsibleBlock.collapse( expansibleCouponContent );\n\t\t\t\t\t\t\t\tCollapsibleBlock.expand( expansibleCouponToggle );\n\n\t\t\t\t\t\t\t\t// Focus back to the add coupon code\n\t\t\t\t\t\t\t\tif ( expansibleCouponToggleButton ) {\n\t\t\t\t\t\t\t\t\texpansibleCouponToggleButton.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function ( jqXHR ) {\n\t\t\t\t\tif ( wc_checkout_params.debug_mode ) {\n\t\t\t\t\t\t/* jshint devel: true */\n\t\t\t\t\t\tconsole.log( jqXHR.responseText );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdataType: 'html'\n\t\t\t});\n\t\t},\n\t\t// CHANGE: Added function to handle `ENTER` key on the coupon code field\n\t\tmaybe_apply_coupon_keydown: function( e ) {\n\t\t\tvar code = e.keyCode || e.which || 0;\n\n\t\t\tif ( $( e.target ).is( 'form.woocommerce-checkout input[name=\"coupon_code\"]' ) && code === 13 ) {\n\t\t\t\te.preventDefault();\n\t\t\t\twc_checkout_coupons.apply_coupon( e );\n\t\t\t}\n\t\t},\n\t};\n\n\tvar wc_checkout_login_form = {\n\t\tinit: function() {\n\t\t\t$( document.body ).on( 'click', 'a.showlogin', this.show_login_form );\n\t\t},\n\t\tshow_login_form: function() {\n\t\t\t$( 'form.login, form.woocommerce-form--login' ).slideToggle();\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tvar wc_terms_toggle = {\n\t\tinit: function() {\n\t\t\t$( document.body ).on( 'click', 'a.woocommerce-terms-and-conditions-link', this.toggle_terms );\n\t\t},\n\n\t\ttoggle_terms: function() {\n\t\t\tif ( $( '.woocommerce-terms-and-conditions' ).length ) {\n\t\t\t\t$( '.woocommerce-terms-and-conditions' ).slideToggle( function() {\n\t\t\t\t\tvar link_toggle = $( '.woocommerce-terms-and-conditions-link' );\n\n\t\t\t\t\tif ( $( '.woocommerce-terms-and-conditions' ).is( ':visible' ) ) {\n\t\t\t\t\t\tlink_toggle.addClass( 'woocommerce-terms-and-conditions-link--open' );\n\t\t\t\t\t\tlink_toggle.removeClass( 'woocommerce-terms-and-conditions-link--closed' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlink_toggle.removeClass( 'woocommerce-terms-and-conditions-link--open' );\n\t\t\t\t\t\tlink_toggle.addClass( 'woocommerce-terms-and-conditions-link--closed' );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t};\n\n\twc_checkout_form.init();\n\twc_checkout_coupons.init();\n\twc_checkout_login_form.init();\n\twc_terms_toggle.init();\n});\n"],"names":["jQuery","$","wc_checkout_params","blockUI","defaults","overlayCSS","cursor","_place_order_selector","_terms_selector","_updateBeforeUnload","wc_checkout_form","updateTimer","dirtyInput","selectedPaymentMethod","xhr","$order_review","$checkout_form","init","document","body","on","this","update_checkout","init_checkout","payment_method_selected","hasClass","submitOrder","attr","submit","validate_field","trigger_update_checkout","input_changed","maybe_input_changed","queue_update_checkout","addEventListener","maybe_update_checkout_visibility_change","maybe_prevent_unload","billing_same_shipping_changed","maybe_reinitialize_collapsible_blocks","maybe_change_shipping_address_edit_button_visibility","terms_checked_changed","init_payment_methods","is_checkout","trigger","option_guest_checkout","toggle_create_account","e","checkbox","fieldsWrapper","window","CollapsibleBlock","querySelector","checked","collapse","expand","collapsibleBlocks","querySelectorAll","i","length","collapsibleBlock","getInstance","initializeElement","$packages","each","$chosen_method","find","$shipping_address_substep","val","startsWith","addClass","removeClass","visibilityState","preventUnload","target","closest","preventDefault","returnValue","removeEventListener","$payment_methods","eq","hide","prop","filter","checkedPaymentMethod","slideUp","get_payment_method","stopPropagation","target_payment_box","is_checked","is","slideDown","show","data","text","termsCheckBoxChecked","maybe_update_checkout","keyCode","which","reset_update_checkout_timer","setTimeout","$required_inputs","update_totals","clearTimeout","is_valid_json","raw_json","json","JSON","parse","$this","$parent","validated","validate_required","validate_email","validate_phone","pattern","event_type","type","RegExp","test","replace","event","args","update_checkout_action","country","state","postcode","city","address","address_2","s_country","s_state","s_postcode","s_city","s_address","has_full_address","shipping_methods","abort","update_shipping_method","s_address_2","security","update_order_review_nonce","payment_method","post_data","serialize","shipping_method","block","message","background","opacity","ajax","url","wc_ajax_url","toString","success","paymentDetails","currentFocusedElement","$form","reload","location","remove","ID","inArray","activeElement","fragments","key","value","replaceWith","unblock","requestAnimationFrame","elementToFocus","formRow","id","getElementById","getAttribute","nameAttr","focus","isEmptyObject","result","messages","prepend","scroll_to_notices","handleUnloadEvent","navigator","userAgent","indexOf","documentMode","attachUnloadEventsOnSubmit","detachUnloadEventsOnSubmit","off","blockOnSubmit","triggerHandler","ajaxSetup","dataFilter","raw_response","dataType","maybe_valid_json","match","console","log","checkout_url","redirect","decodeURI","err","refresh","submit_error","i18n_checkout_error","error","jqXHR","textStatus","errorThrown","error_message","scrollElement","wc_checkout_coupons","show_coupon_form","remove_coupon","apply_coupon","maybe_apply_coupon_keydown","slideToggle","apply_coupon_nonce","coupon_code","code","before","container","parents","coupon","remove_coupon_nonce","remove_button","debug_mode","responseText","coupon_field","apply_button","expansibleCouponToggle","expansibleCouponContent","expansibleCouponToggleButton","wc_checkout_login_form","show_login_form","wc_terms_toggle","toggle_terms","link_toggle"],"mappings":"AAOAA,OAAQ,SAAUC,GAGjB,GAAmC,oBAAvBC,mBACX,OAAO,EAGRD,EAAEE,QAAQC,SAASC,WAAWC,OAAS,UAGvC,IAAIC,EAAwB,uCACxBC,EAAkB,qBAClBC,GAAsB,EAGtBC,EAAmB,CACtBC,aAAa,EACbC,YAAY,EACZC,uBAAuB,EACvBC,KAAK,EACLC,cAAed,EAAG,iBAClBe,eAAgBf,EAAG,iBACnBgB,KAAM,WACLhB,EAAGiB,SAASC,MAAOC,GAAI,kBAAmBC,KAAKC,iBAC/CrB,EAAGiB,SAASC,MAAOC,GAAI,gBAAiBC,KAAKE,eAG7CF,KAAKL,eAAeI,GAAI,QAAS,+BAAgCC,KAAKG,yBAEjEvB,EAAGiB,SAASC,MAAOM,SAAU,2BACjCJ,KAAKN,cAAcK,GAAI,QAAS,+BAAgCC,KAAKG,yBACrEH,KAAKN,cAAcK,GAAI,SAAUC,KAAKK,aACtCL,KAAKN,cAAcY,KAAM,aAAc,eAIxCN,KAAKL,eAAeW,KAAM,aAAc,cAGxCN,KAAKL,eAAeI,GAAI,SAAUC,KAAKO,QAGvCP,KAAKL,eAAeI,GAAI,wBAAyB,sCAAuCC,KAAKQ,gBAG7FR,KAAKL,eAAeI,GAAI,SAAUC,KAAKS,yBAIvCT,KAAKL,eAAeI,GAAI,SAAU,yLAA0LC,KAAKS,yBACjOT,KAAKL,eAAeI,GAAI,SAAU,wBAAyBC,KAAKU,eAEhEV,KAAKL,eAAeI,GAAI,SAAU,yHAA0HC,KAAKW,qBAEjKX,KAAKL,eAAeI,GAAI,UAAW,yHAA0HC,KAAKY,uBAMlKf,SAASgB,iBAAkB,mBAAoBb,KAAKc,yCAGpDd,KAAKL,eAAeI,GAAI,SAAU,0BAA2BC,KAAKe,sBAGlEf,KAAKL,eAAeI,GAAI,SAAU,4BAA6BC,KAAKgB,+BACpEpC,EAAGiB,SAASC,MAAOC,GAAI,mBAAoBC,KAAKiB,uCAGhDrC,EAAGiB,SAASC,MAAOC,GAAI,mBAAoBC,KAAKkB,sDAGhDlB,KAAKL,eAAeI,GAAI,SAAUZ,EAAiBa,KAAKmB,uBAIxDnB,KAAKoB,uBAGmC,MAAnCvC,mBAAmBwC,aACvBzC,EAAGiB,SAASC,MAAOwB,QAAS,iBAEqB,QAA7CzC,mBAAmB0C,uBACvB3C,EAAG,uBAAwBmB,GAAI,SAAUC,KAAKwB,uBAAwBF,QAAS,WAIjFN,8BAA+B,SAAUS,GACxC,IACKC,EACAC,EAFAC,OAAOC,mBACPH,EAAW7B,SAASiC,cAAe,6BACnCH,EAAgB9B,SAASiC,cAAe,8CAGrCJ,EAASK,QAIfF,iBAAiBG,SAAUL,GAH3BE,iBAAiBI,OAAQN,IAO3B/C,EAAGiB,SAASC,MAAOwB,QAAS,oBAG7BL,sCAAuC,WACtC,GAAKW,OAAOC,iBAEX,IADA,IAAIK,EAAoBrC,SAASsC,iBAAkB,sBACzCC,EAAI,EAAGA,EAAIF,EAAkBG,OAAQD,IAAM,CACpD,IAAIE,EAAmBJ,EAAkBE,GAGlCP,iBAAiBU,YAAaD,IACpCT,iBAAiBW,kBAAmBF,KAMxCpB,qDAAsD,WACrD,IAAIuB,EAAY7D,EAAG,6BACd6D,EAAUJ,QACdI,EAAUC,KAAM,WAEf,IAAIC,EAAiB/D,EAAGoB,MAAO4C,KAAM,iCACjCC,EAA4BjE,EAAG,yDACb+D,EAAeG,MAAMC,WAAY,gBAItDF,EAA0BG,SAAU,6BAGpCH,EAA0BI,YAAa,gCAO3CnC,wCAAyC,WACP,UAA5BjB,SAASqD,iBACbtE,EAAGiB,SAASC,MAAOwB,QAAS,oBAI9BP,qBAAsB,SAAUU,GAE/B,IAIK0B,EAJA1B,GAAKA,EAAE2B,OAAOC,QAAS,sCAErBjE,IAEF+D,EAAgB,SAAU1B,GAExBrC,IACJqC,EAAE6B,iBACF7B,EAAE8B,YAAc,GAGhB3E,EAAGiB,SAASC,MAAOwB,QAAS,mBAG5BlC,GAAsB,EACtBwC,OAAO4B,oBAAqB,eAAgBL,KAI9CvB,OAAOf,iBAAkB,eAAgBsC,GACzC/D,GAAsB,IAGxBgC,qBAAsB,WACrB,IAAIqC,EAAmB7E,EAAG,yBAA0BgE,KAAM,gCAGrD,IAAMa,EAAiBpB,QAC3BoB,EAAiBC,GAAG,GAAGC,OAInBtE,EAAiBG,uBACrBZ,EAAG,IAAMS,EAAiBG,uBAAwBoE,KAAM,WAAW,GAI/D,IAAMH,EAAiBI,OAAQ,YAAaxB,QAChDoB,EAAiBC,GAAG,GAAGE,KAAM,WAAW,GAIzC,IAAIE,EAAuBL,EAAiBI,OAAQ,YAAaH,GAAG,GAAGE,KAAM,MAE9C,EAA1BH,EAAiBpB,QAErBzD,EAAG,yBAA2BkF,EAAuB,MAAOD,OAAQ,YAAaE,QAAS,GAI3FN,EAAiBI,OAAQ,YAAaH,GAAG,GAAGpC,QAAS,UAEtD0C,mBAAoB,WACnB,OAAO3E,EAAiBM,eAAeiD,KAAM,wCAAyCE,OAEvF3C,wBAAyB,SAAUsB,GAClCA,EAAEwC,kBAEsD,EAAnDrF,EAAG,sCAAuCyD,QAC1C6B,EAAqBtF,EAAG,mBAAqBA,EAAGoB,MAAOM,KAAM,QAChE6D,EAAqBvF,EAAGoB,MAAOoE,GAAI,eAEfF,EAAmBE,GAAI,cAC3CxF,EAAG,mBAAoBiF,OAAQ,YAAaE,QAAS,KAEhDI,GACJD,EAAmBG,UAAW,OAIhCzF,EAAG,mBAAoB0F,OAGnB1F,EAAGoB,MAAOuE,KAAM,qBAEpB3F,EAAGM,GAAwBsF,KAAM5F,EAAGoB,MAAOuE,KAAM,sBAGjD3F,EAAGM,GAAwBsF,KAAM5F,EAAGM,GAAwBqF,KAAM,UAGnE,IAAI/E,EAAwBZ,EAAG,8DAA+D0B,KAAM,MAE/Fd,IAA0BH,EAAiBG,uBAC/CZ,EAAGiB,SAASC,MAAOwB,QAAS,2BAG7BjC,EAAiBG,sBAAwBA,GAE1CgC,sBAAuB,WACtB5C,EAAG,sBAAuB+E,OAErB/E,EAAGoB,MAAOoE,GAAI,cAElBxF,EAAG,qBAAsBkE,IAAK,IAAKxB,QAAS,UAC5C1C,EAAG,sBAAuByF,cAG5BnE,cAAe,WACdtB,EAAGiB,SAASC,MAAOwB,QAAS,oBAE7BX,oBAAqB,SAAUc,GACzBpC,EAAiBE,YACrBF,EAAiBqB,cAAee,IAIlCN,sBAAuB,SAAUM,GAC5BgD,EAAuB7F,EAAG6C,EAAE2B,QAASQ,KAAM,WAC/ChF,EAAGO,GAAkByE,KAAM,UAAWa,IAEvC/D,cAAe,SAAUe,GACxBpC,EAAiBE,WAAakC,EAAE2B,OAChC/D,EAAiBqF,yBAElB9D,sBAAuB,SAAUa,GAGhC,GAAc,KAFHA,EAAEkD,SAAWlD,EAAEmD,OAAS,GAGlC,OAAO,EAGRvF,EAAiBE,WAAaS,KAC9BX,EAAiBwF,8BACjBxF,EAAiBC,YAAcwF,WAAYzF,EAAiBqF,sBAAuB,SAEpFjE,wBAAyB,WACxBpB,EAAiBwF,8BACjBxF,EAAiBE,YAAa,EAC9BX,EAAGiB,SAASC,MAAOwB,QAAS,oBAE7BoD,sBAAuB,WACtB,IAGKK,EAHDC,GAAgB,GAEfpG,EAAGS,EAAiBE,YAAa8C,SACjC0C,EAAmBnG,EAAGS,EAAiBE,YAAa8D,QAAS,OAAQT,KAAM,qCAEzDP,QACrB0C,EAAiBrC,KAAM,WAC8B,KAA/C9D,EAAGoB,MAAO4C,KAAM,oBAAqBE,QACzCkC,GAAgB,KAKfA,GACJ3F,EAAiBoB,2BAInBoE,4BAA6B,WAC5BI,aAAc5F,EAAiBC,cAEhC4F,cAAe,SAAUC,GACxB,IACC,IAAIC,EAAOC,KAAKC,MAAOH,GAEvB,OAASC,GAAQ,iBAAoBA,EACpC,MAAQ3D,GACT,OAAO,IAGTjB,eAAgB,SAAUiB,GACzB,IAAI8D,EAAoB3G,EAAGoB,MAC1BwF,EAAoBD,EAAMlC,QAAS,aACnCoC,GAAoB,EACpBC,EAAoBF,EAAQpB,GAAI,sBAChCuB,EAAoBH,EAAQpB,GAAI,mBAChCwB,EAAoBJ,EAAQpB,GAAI,mBAChCyB,EAAoB,GACpBC,EAAoBrE,EAAEsE,KAElB,UAAYD,GAChBN,EAAQvC,YAAa,oIAGjB,aAAe6C,GAAc,WAAaA,IAEzCJ,IACC,aAAeH,EAAMjF,KAAM,UAAciF,EAAMnB,GAAI,aAG5B,KAAhBmB,EAAMzC,SAFjB0C,EAAQvC,YAAa,yBAA0BD,SAAU,0DACzDyC,GAAY,GAOTE,GACCJ,EAAMzC,SAEV+C,EAAU,IAAIG,OAAQ,svBAEPC,KAAMV,EAAMzC,SAC1B0C,EAAQvC,YAAa,yBAA0BD,SAAU,2EACzDyC,GAAY,IAKVG,IACJC,EAAU,IAAIG,OAAQ,2BAEjB,EAAIT,EAAMzC,MAAMoD,QAASL,EAAS,IAAKxD,SAC3CmD,EAAQvC,YAAa,yBAA0BD,SAAU,iDACzDyC,GAAY,IAITA,GACJD,EAAQvC,YAAa,8GAA+GD,SAAU,2BAIjJ/C,gBAAiB,SAAUkG,EAAOC,GAEjC/G,EAAiBwF,8BACjBxF,EAAiBC,YAAcwF,WAAYzF,EAAiBgH,uBAAwB,IAAKD,IAE1FC,uBAAwB,SAAUD,GAKjC,IAQIE,EACHC,EACAC,EACAC,EACAC,EACAC,EAEAC,EACAC,EACAC,EACAC,EACAC,EAGAjC,EACAkC,EAYG1C,EAoBC2C,EA3DA7H,EAAiBI,KACrBJ,EAAiBI,IAAI0H,QAGe,IAAhCvI,EAAG,iBAAkByD,SAI1B+D,OAAuB,IAATA,EAAuBA,EAAO,CAC3CgB,wBAAwB,GAGrBd,EAAa1H,EAAG,oBAAqBkE,MACxCyD,EAAW3H,EAAG,kBAAmBkE,MACjC0D,EAAa5H,EAAG,2BAA4BkE,MAC5C2D,EAAU7H,EAAG,iBAAkBkE,MAC/B4D,EAAa9H,EAAG,4BAA6BkE,MAC7C6D,EAAc/H,EAAG,4BAA6BkE,MAE9C8D,EAAchI,EAAG,qBAAsBkE,MACvC+D,EAAajI,EAAG,mBAAoBkE,MACpCgE,EAAelI,EAAG,4BAA6BkE,MAC/CiE,EAAYnI,EAAG,kBAAmBkE,MAClCkE,EAAcpI,EAAG,6BAA8BkE,MAC/CuE,EAAgBzI,EAAG,6BAA8BkE,MAEjDiC,EAAmBnG,EAAGS,EAAiBM,gBAAiBiD,KAAM,4CAC9DqE,GAAmB,EAEflC,EAAiB1C,QACrB0C,EAAiBrC,KAAM,WACoB,KAArC9D,EAAGoB,MAAO4C,KAAM,UAAWE,QAC/BmE,GAAmB,OAOlB1C,EAAO,CACV+C,SAAkBzI,mBAAmB0I,0BACrCC,eAAkBnI,EAAiB2E,qBACnCsC,QAAkBA,EAClBC,MAAkBA,EAClBC,SAAkBA,EAClBC,KAAkBA,EAClBC,QAAkBA,EAClBC,UAAkBA,EAClBC,UAAkBA,EAClBC,QAAkBA,EAClBC,WAAkBA,EAClBC,OAAkBA,EAClBC,UAAkBA,EAClBK,YAAkBA,EAClBJ,iBAAkBA,EAClBQ,UAAkB7I,EAAG,iBAAkB8I,gBAGzBtB,EAAKgB,yBACfF,EAAmB,GAGvBtI,EAAG,+HAAgI8D,KAAM,WACxIwE,EAAkBtI,EAAGoB,MAAOuE,KAAM,UAAc3F,EAAGoB,MAAO8C,QAG3DyB,EAAKoD,gBAAkBT,GAIxBtI,EAAG,uIAAwIgJ,MAAM,CAChJC,QAAS,KACT7I,WAAY,CACX8I,WAAY,OACZC,QAAS,MAIX1I,EAAiBI,IAAMb,EAAEoJ,KAAK,CAC7BjC,KAAO,OACPkC,IAAMpJ,mBAAmBqJ,YAAYC,WAAWjC,QAAS,eAAgB,uBACzE3B,KAAOA,EACP6D,QAAS,SAAU7D,GAGlB,IAYI8D,EAcAC,EAkECC,EA5FAhE,IAAQ,IAASA,EAAKiE,OAC1B5G,OAAO6G,SAASD,UAKjB5J,EAAG,8CAA+C8J,SAG9CjE,EAAuB7F,EAAGO,GAAkByE,KAAM,WAGlDyE,EAAiB,GACrBzJ,EAAG,uBAAwB8D,KAAM,WAChC,IAAIiG,EAAK/J,EAAGoB,MAAOM,KAAM,MAEpBqI,KACqE,IAApE/J,EAAEgK,QAAShK,EAAGoB,MAAOM,KAAM,QAAU,CAAE,WAAY,UACvD+H,EAAgBM,GAAO/J,EAAGoB,MAAO4D,KAAM,WAEvCyE,EAAgBM,GAAO/J,EAAGoB,MAAO8C,SAMhCwF,EAAwBzI,SAASgJ,cAGhCtE,GAAQA,EAAKuE,YACjBlK,EAAE8D,KAAM6B,EAAKuE,UAAW,SAAWC,EAAKC,GAChC3J,EAAiByJ,WAAazJ,EAAiByJ,UAAWC,KAAUC,GAC1EpK,EAAGmK,GAAME,YAAaD,GAEvBpK,EAAGmK,GAAMG,YAEV7J,EAAiByJ,UAAYvE,EAAKuE,WAInCK,sBAAuB,WACtB,IASCC,EAIIC,EAVAf,EAAsBgB,GAC1BF,EAAiBvJ,SAAS0J,eAAgBjB,EAAsBgB,IAGvDhB,EAAsBkB,aAAc,SACzCC,EAAWnB,EAAsBkB,aAAc,QACnDJ,EAAiBvJ,SAASiC,cAAe,UAAU2H,EAAS,QAGnDnB,EAAsBjF,QAAS,eACpCgG,EAAUf,EAAsBjF,QAAS,cAChCiG,KACZF,EAAiBvJ,SAASiC,cAAe,iBAAiBuH,EAAQC,GAAG,0BAKlEF,GACJA,EAAeM,UAMZjF,GAEJ7F,EAAGO,GAAkByE,KAAM,WAAW,GAIhChF,EAAE+K,cAAetB,IACvBzJ,EAAG,uBAAwB8D,KAAM,WAChC,IAAIiG,EAAK/J,EAAGoB,MAAOM,KAAM,MACpBqI,KACqE,IAApE/J,EAAEgK,QAAShK,EAAGoB,MAAOM,KAAM,QAAU,CAAE,WAAY,UACvD1B,EAAGoB,MAAO4D,KAAM,UAAWyE,EAAgBM,IAAOrH,QAAS,YACS,IAAzD1C,EAAEgK,QAAShK,EAAGoB,MAAOM,KAAM,QAAU,CAAE,YAEvC,OAAS1B,EAAGoB,MAAO8C,OAAS,IAAMlE,EAAGoB,MAAO8C,MAAMT,SAD7DzD,EAAGoB,MAAO8C,IAAKuF,EAAgBM,IAAOrH,QAAS,aAS9CiD,GAAQ,YAAcA,EAAKqF,SAE3BrB,EAAQ3J,EAAG,iBAGfA,EAAG,4CAA6C8J,SAG3CnE,EAAKsF,SACTtB,EAAMuB,QAAS,kFAAoFvF,EAAKsF,SAAW,UAEnHtB,EAAMuB,QAASvF,GAIhBgE,EAAM3F,KAAM,uCAAwCtB,QAAS,YAAaA,QAAS,QAEnFjC,EAAiB0K,qBAIlB1K,EAAiB+B,uBAGjBhC,GAAsB,EAGtBR,EAAGiB,SAASC,MAAOwB,QAAS,mBAAoB,CAAEiD,UAKrDyF,kBAAmB,SAAUvI,GAM5B,IAA6C,IAAzCwI,UAAUC,UAAUC,QAAQ,UAAuBtK,SAASuK,aAMhE,OAAO,EAJN3I,EAAE6B,kBAMJ+G,2BAA4B,WAC3BzL,EAAGgD,QAAS7B,GAAG,eAAgBC,KAAKgK,oBAErCM,2BAA4B,WAC3B1L,EAAGgD,QAAS2I,IAAI,eAAgBvK,KAAKgK,oBAEtCQ,cAAe,SAAUjC,GAGnB,IAFWA,EAAMhE,KAAM,sBAG3BgE,EAAMX,MAAM,CACXC,QAAS,KACT7I,WAAY,CACX8I,WAAY,OACZC,QAAS,OAKb1H,YAAa,WACZhB,EAAiBmL,cAAe5L,EAAGoB,QAEpCO,OAAQ,WACPlB,EAAiBwF,8BACjB,IAAI0D,EAAQ3J,EAAGoB,MAEf,OAAKuI,EAAMnE,GAAI,iBAKfhF,GAAsB,KAIjBmJ,EAAMkC,eAAgB,0BAAkI,IAA5FlC,EAAMkC,eAAgB,wBAA0BpL,EAAiB2E,wBAEjIuE,EAAMvF,SAAU,cAEhB3D,EAAiBmL,cAAejC,GAGhClJ,EAAiBgL,6BAGjBzL,EAAE8L,UAAW,CACZC,WAAY,SAAUC,EAAcC,GAEnC,GAAK,SAAWA,EACf,OAAOD,EAGR,GAAKvL,EAAiB6F,cAAe0F,GACpC,OAAOA,EAGHE,EAAmBF,EAAaG,MAAO,eAa5C,OAXM,OAASD,GAEFzL,EAAiB6F,cAAe4F,EAAiB,KAC5DE,QAAQC,IAAK,mCACbD,QAAQC,IAAKL,GACbA,EAAeE,EAAiB,IAJhCE,QAAQC,IAAK,gCAURL,KAIThM,EAAEoJ,KAAK,CACNjC,KAAO,OACPkC,IAAMpJ,mBAAmBqM,aACzB3G,KAAOgE,EAAMb,YACbmD,SAAY,OACZzC,QAAS,SAAUwB,GAElBvK,EAAiBiL,6BAEjB,IACC,GAAK,YAAcV,EAAOA,SAA6E,IAAnErB,EAAMkC,eAAgB,+BAAgCb,GAMnF,KAAK,YAAcA,EAAOA,OAC1B,iBAEA,oBARA,IAAMA,EAAOuB,SAAShB,QAAS,cAAiB,IAAMP,EAAOuB,SAAShB,QAAS,WACpFvI,OAAO6G,SAAWmB,EAAOuB,SAEzBvJ,OAAO6G,SAAW2C,UAAWxB,EAAOuB,UAOrC,MAAOE,GAER,IAAK,IAASzB,EAAOpB,OAEpB,YADA5G,OAAO6G,SAASD,UAKZ,IAASoB,EAAO0B,SACpB1M,EAAGiB,SAASC,MAAOwB,QAAS,mBAIxBsI,EAAOC,SACXxK,EAAiBkM,aAAc3B,EAAOC,UAEtCxK,EAAiBkM,aAAc,kCAAoC1M,mBAAmB2M,oBAAsB,YAI/GC,MAAO,SAAUC,EAAOC,EAAYC,GAEnCvM,EAAiBiL,6BAEjBjL,EAAiBkM,aAAc,kCAAoCK,EAAc,eA3F5E,GAkGTL,aAAc,SAAUM,GACvBjN,EAAG,+EAAgF8J,SACnFrJ,EAAiBM,eAAemK,QAAS,yEAA2E+B,EAAgB,UACpIxM,EAAiBM,eAAesD,YAAa,cAAeiG,UAC5D7J,EAAiBM,eAAeiD,KAAM,uCAAwCtB,QAAS,YAAaA,QAAS,QAC7GjC,EAAiB0K,oBACjBnL,EAAGiB,SAASC,MAAOwB,QAAS,iBAAmB,CAAEuK,KAElD9B,kBAAmB,WAClB,IAAI+B,EAA0BlN,EAAG,iFAE1BkN,EAAczJ,SACpByJ,EAAgBlN,EAAG,mBAEpBA,EAAEmL,kBAAmB+B,KAInBC,EAAsB,CACzBnM,KAAM,WACLhB,EAAGiB,SAASC,MAAOC,GAAI,QAAS,eAAgBC,KAAKgM,kBACrDpN,EAAGiB,SAASC,MAAOC,GAAI,QAAS,6BAA8BC,KAAKiM,eACnErN,EAAG,wBAAyB+E,OAAO5D,GAAI,SAAUC,KAAKO,QAEtD3B,EAAGiB,SAASC,MAAOC,GAAI,QAAS,6BAA8BC,KAAKkM,cACnE7M,EAAiBM,eAAeI,GAAI,UAAW,4BAA6BC,KAAKmM,6BAElFH,iBAAkB,WAIjB,OAHApN,EAAG,oBAAqBwN,YAAa,IAAK,WACzCxN,EAAG,oBAAqBgE,KAAM,gBAAiBtB,QAAS,YAElD,GAERf,OAAQ,WACP,IAAIgI,EAAQ3J,EAAGoB,MAEf,GAAKuI,EAAMnE,GAAI,eACd,OAAO,EAGRmE,EAAMvF,SAAU,cAAe4E,MAAM,CACpCC,QAAS,KACT7I,WAAY,CACX8I,WAAY,OACZC,QAAS,MAIX,IAAIxD,EAAO,CACV+C,SAAWzI,mBAAmBwN,mBAC9BC,YAAa/D,EAAM3F,KAAM,6BAA8BE,OAsBxD,OAnBAlE,EAAEoJ,KAAK,CACNjC,KAAO,OACPkC,IAAMpJ,mBAAmBqJ,YAAYC,WAAWjC,QAAS,eAAgB,gBACzE3B,KAAOA,EACP6D,QAAS,SAAUmE,GAClB3N,EAAG,4CAA6C8J,SAChDH,EAAMtF,YAAa,cAAeiG,UAE7BqD,IACJhE,EAAMiE,OAAQD,GACdhE,EAAMxE,UAENnF,EAAGiB,SAASC,MAAOwB,QAAS,6BAA8B,CAAEiD,EAAK+H,cACjE1N,EAAGiB,SAASC,MAAOwB,QAAS,kBAAmB,CAAE8F,wBAAwB,MAG3EyD,SAAU,UAGJ,GAERoB,cAAe,SAAUxK,GACxBA,EAAE6B,iBAEF,IAAImJ,EAAY7N,EAAGoB,MAAO0M,QAAS,sCAClCC,EAAY/N,EAAGoB,MAAOuE,KAAM,UAE7BkI,EAAUzJ,SAAU,cAAe4E,MAAM,CACxCC,QAAS,KACT7I,WAAY,CACX8I,WAAY,OACZC,QAAS,MAIX,IAAIxD,EAAO,CACV+C,SAAUzI,mBAAmB+N,oBAC7BD,OAAUA,GAIPE,EAAkBjO,EAAGoB,MACzB6M,EAAcjJ,KAAM,YAAY,GAChCiJ,EAAc7J,SAAU,cAExBpE,EAAEoJ,KAAK,CACNjC,KAAS,OACTkC,IAASpJ,mBAAmBqJ,YAAYC,WAAWjC,QAAS,eAAgB,iBAC5E3B,KAASA,EACT6D,QAAS,SAAUmE,GAClB3N,EAAG,4CAA6C8J,SAChD+D,EAAUxJ,YAAa,cAAeiG,UAGtC2D,EAAcjJ,KAAM,YAAY,GAChCiJ,EAAc5J,YAAa,cAEtBsJ,IAEsE,EAArEM,EAAcH,QAAS,oCAAqCrK,OAChEwK,EAAcH,QAAS,oCAAqC5C,QAASyC,GAGrE3N,EAAG,6BAA8B4N,OAAQD,GAG1C3N,EAAGiB,SAASC,MAAOwB,QAAS,6BAA8B,CAAEiD,EAAK+H,cACjE1N,EAAGiB,SAASC,MAAOwB,QAAS,kBAAmB,CAAE8F,wBAAwB,IAGzExI,EAAG,wBAAyBgE,KAAM,6BAA8BE,IAAK,IAGrElE,EAAG,6BAA8BgE,KAAM,6BAA8BE,IAAK,MAG5E2I,MAAO,SAAWC,GACZ7M,mBAAmBiO,YAEvB9B,QAAQC,IAAKS,EAAMqB,eAGrBlC,SAAU,UAIZqB,aAAc,SAAUzK,GACvBA,EAAE6B,iBAEF,IAAIgJ,EAAiB1N,EAAG,6BAA8BgE,KAAM,6BAA8BE,MACtFkK,EAAiBpO,EAAG,6BAA8BgE,KAAM,6BACxDqK,EAAiBrO,EAAG,6BAA8BgE,KAAM,8BAExD2B,EAAO,CACV+C,SAAUzI,mBAAmBwN,mBAC7BC,YAAeA,GAIhBU,EAAapJ,KAAM,YAAY,GAC/BqJ,EAAarJ,KAAM,YAAY,GAC/BqJ,EAAajK,SAAU,cAEvBpE,EAAEoJ,KAAK,CACNjC,KAAS,OACTkC,IAASpJ,mBAAmBqJ,YAAYC,WAAWjC,QAAS,eAAgB,gBAC5E3B,KAASA,EACT6D,QAAS,SAAUmE,GAQlB,IAeMW,EACAC,EAvBNvO,EAAG,4CAA6C8J,SAGhDsE,EAAapJ,KAAM,YAAY,GAC/BqJ,EAAarJ,KAAM,YAAY,GAC/BqJ,EAAahK,YAAa,cAErBsJ,IACJ3N,EAAG,gDAAiD4N,OAAQD,GAE5D3N,EAAGiB,SAASC,MAAOwB,QAAS,6BAA8B,CAAEiD,EAAK+H,cACjE1N,EAAGiB,SAASC,MAAOwB,QAAS,kBAAmB,CAAE8F,wBAAwB,IAGzExI,EAAG,wBAAyBgE,KAAM,6BAA8BE,IAAK,IAGrElE,EAAG,6BAA8BgE,KAAM,6BAA8BE,IAAK,IAGrElB,OAAOC,mBAEPqL,EAAyBrN,SAASiC,cAAe,8EACjDqL,EAA0BtN,SAASiC,cAAe,+EAClDsL,EAA+BvN,SAASiC,cAAe,2EAEtDoL,GAA0BC,IAE9BtL,iBAAiBG,SAAUmL,GAC3BtL,iBAAiBI,OAAQiL,GAGpBE,GACJA,EAA6B1D,YAMlC+B,MAAO,SAAWC,GACZ7M,mBAAmBiO,YAEvB9B,QAAQC,IAAKS,EAAMqB,eAGrBlC,SAAU,UAIZsB,2BAA4B,SAAU1K,GACrC,IAAI8K,EAAO9K,EAAEkD,SAAWlD,EAAEmD,OAAS,EAE9BhG,EAAG6C,EAAE2B,QAASgB,GAAI,wDAAoE,KAATmI,IACjF9K,EAAE6B,iBACFyI,EAAoBG,aAAczK,MAKjC4L,EAAyB,CAC5BzN,KAAM,WACLhB,EAAGiB,SAASC,MAAOC,GAAI,QAAS,cAAeC,KAAKsN,kBAErDA,gBAAiB,WAEhB,OADA1O,EAAG,4CAA6CwN,eACzC,IAILmB,EAAkB,CACrB3N,KAAM,WACLhB,EAAGiB,SAASC,MAAOC,GAAI,QAAS,0CAA2CC,KAAKwN,eAGjFA,aAAc,WACb,GAAK5O,EAAG,qCAAsCyD,OAa7C,OAZAzD,EAAG,qCAAsCwN,YAAa,WACrD,IAAIqB,EAAc7O,EAAG,0CAEhBA,EAAG,qCAAsCwF,GAAI,aACjDqJ,EAAYzK,SAAU,+CACtByK,EAAYxK,YAAa,mDAEzBwK,EAAYxK,YAAa,+CACzBwK,EAAYzK,SAAU,qDAIjB,IAKV3D,EAAiBO,OACjBmM,EAAoBnM,OACpByN,EAAuBzN,OACvB2N,EAAgB3N"}